require=function e(t,n,i){function o(a,r){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!r&&s)return s(a,!0);if(c)return c(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return o(n||e)},d,d.exports,e,t,n,i)}return n[a].exports}for(var c="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({Controller:[function(e,t,n){"use strict";function i(e){return void 0!==window.URL?window.URL.createObjectURL(e):window.webkitURL.createObjectURL(e)}function o(e){h(i(e.target.files[0]))}function c(e){a(i(e.target.files[0]))}function a(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===(n=document.getElementById("tempDivReference"))){var n=document.createElement("div");document.body.appendChild(n),n.style.position="absolute",n.id="tempDivReference",n.innerHTML="<img id=imgheadReference>",n.style.display="none",n.style.visibility="hidden"}var i=document.getElementById("imgheadReference");i.onload=function(){if(this.complete){var e=parseFloat(this.width),n=parseFloat(this.height);e>n?(e*=224/n,n=224):(n*=224/e,e=224);var i=parseFloat(this.width),o=parseFloat(this.height);i<o?(i*=380/o,o=380):(o*=380/i,i=380),u.node.width=parseInt(i),u.node.height=parseInt(o),T.width=parseInt(e),T.height=parseInt(n),T.getContext("2d").drawImage(this,0,0,T.width,T.height);var c=u.spriteFrame.getTexture();c.initWithElement(T),c.handleLoadedTexture();var a=document.createElement("canvas");if(a.width=parseInt(i),a.height=parseInt(o),a.getContext("2d").drawImage(this,0,0,a.width,a.height),c._pixels=a.getContext("2d").getImageData(0,0,a.width,a.height).data,t){b.getContext("2d").clearRect(0,0,b.width,b.height);var r=m.getComponent("cc.Sprite").spriteFrame.getTexture();r.initWithElement(b),r.handleLoadedTexture()}H=!0,G="new"}},i.src=e}function r(){b.getContext("2d").clearRect(0,0,b.width,b.height);var e=m.getComponent("cc.Sprite").spriteFrame.getTexture();e.initWithElement(b),e.handleLoadedTexture(),T.getContext("2d").clearRect(0,0,T.width,T.height);var t=u.spriteFrame.getTexture();t.initWithElement(T),t.handleLoadedTexture(),F.getContext("2d").clearRect(0,0,F.width,F.height);var n=p.spriteFrame.getTexture();n.initWithElement(F),n.handleLoadedTexture(),g.spriteFrame.setTexture(L)}function s(e){2==(I=e.split("*")).length&&(K="results/"+I[0]+".jpg?t="+Math.random().toString(),te=cc.textureCache.addImage(K))}function l(e){ne=!0,M=!1,H=!1,j=!1,h("samples\\"+e+"\\content.png",!1),a("samples\\"+e+"\\style.png",!1),d("samples\\"+e+"\\hint.png"),K="samples\\"+e+"\\result.png",_.active=!1}function d(e){b.getContext("2d").clearRect(0,0,b.width,b.height);var t=m.getComponent("cc.Sprite").spriteFrame.getTexture();if(t.initWithElement(b),t.handleLoadedTexture(!0),null===(n=document.getElementById("tempDivHint"))){var n=document.createElement("div");document.body.appendChild(n),n.style.position="absolute",n.id="tempDivHint",n.innerHTML="<img id=imgheadHint>",n.style.display="none",n.style.visibility="hidden"}var i=document.getElementById("imgheadHint");i.onload=function(){this.complete&&setTimeout(function(){var e=parseFloat(i.width),t=parseFloat(i.height);b.width=parseInt(e),b.height=parseInt(t),b.getContext("2d").drawImage(i,0,0,b.width,b.height);var n=m.getComponent("cc.Sprite").spriteFrame.getTexture();n.initWithElement(b),n.handleLoadedTexture(!0),M=!0},500)},i.src=e}function h(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===(n=document.getElementById("tempDivSketch"))){var n=document.createElement("div");document.body.appendChild(n),n.style.position="absolute",n.id="tempDivSketch",n.innerHTML="<img id=imgheadSketch>",n.style.display="none",n.style.visibility="hidden"}var i=document.getElementById("imgheadSketch");i.onload=function(){if(this.complete){var e=parseFloat(this.width),n=parseFloat(this.height);n<e?n>1024&&(e*=1024/n,n=1024):e>1024&&(n*=1024/e,e=1024),F.width=parseInt(e),F.height=parseInt(n),X=parseFloat(this.width),$=parseFloat(this.height),F.getContext("2d").drawImage(this,0,0,F.width,F.height);var i=p.spriteFrame.getTexture();if(i.initWithElement(F),i.handleLoadedTexture(),t){n<e?(e*=1024/n,n=1024):(n*=1024/e,e=1024),b.width=parseInt(e),b.height=parseInt(n),b.getContext("2d").clearRect(0,0,b.width,b.height);var o=m.getComponent("cc.Sprite").spriteFrame.getTexture();o.initWithElement(b),o.handleLoadedTexture()}j=!0,A="new",G="new",g.spriteFrame.setTexture(L),k.opacity=255,_.active=!1}},i.src=e}cc._RF.push(t,"a2f315Lr3BIGZGXpazlQtl/","Controller");var p,u,g,f,m,C,y,w,x,v,F,T,b,I,R,L,k,S,_,D=!1,N=!1,E=!1,B=!1,U=!1,O=!1,q=0,W=0,j=!1,H=!1,M=!1,P=!0,z=!1,A="new",G="new",K="",Q="colorize",Y="true",J="true",Z="quality",V="",X=10,$=10,ee=!1,te=null,ne=!1;cc.Texture2D.prototype._pixels=[],cc.Texture2D.prototype.getPixels=function(e,t,n,i){var o=parseInt((i-parseInt(t))*n*4+4*parseInt(e));return new cc.color(this._pixels[o],this._pixels[o+1],this._pixels[o+2])},cc.Class({extends:cc.Component,properties:{sketchImg:{default:null,type:cc.Node},referenceImg:{default:null,type:cc.Node},resultImg:{default:null,type:cc.Node},colorImg:{default:null,type:cc.Node},flag:{default:null,type:cc.Node},hint:{default:null,type:cc.Node},btn:{default:null,type:cc.Node},view:{default:null,type:cc.Node},quickBTN:{default:null,type:cc.Node},waiting:{default:null,type:cc.Node},welcome:{default:null,type:cc.Node},nodeSketchDenoising:{default:null,type:cc.Node},nodeResultDenoising:{default:null,type:cc.Node},nodeOpColorize:{default:null,type:cc.Node},nodeOpRender:{default:null,type:cc.Node},nodeOpTransfer:{default:null,type:cc.Node},nodeStability:{default:null,type:cc.Node},nodeQuality:{default:null,type:cc.Node},loading:{default:"",type:cc.String}},onQualityFirst:function(){Z="quality"},onStabilityFirst:function(){Z="stability"},onOpColorize:function(){Q="colorize"},onOpRender:function(){Q="render"},onOpTransfer:function(){Q="transfer"},onSample:function(e,t){if(!ee){this.disableAll(),r();var n=e.target.getComponent("sampler");Y=n.sketchDenoise,J=n.resultDenoise,Q=n.method,Z=n.algrithom,this.nodeSketchDenoising.getComponent("cc.Toggle").isChecked="true"==Y,this.nodeResultDenoising.getComponent("cc.Toggle").isChecked="true"==J,this.nodeOpColorize.getComponent("cc.Toggle").isChecked="colorize"==Q,this.nodeOpRender.getComponent("cc.Toggle").isChecked="render"==Q,this.nodeOpTransfer.getComponent("cc.Toggle").isChecked="transfer"==Q,this.nodeQuality.getComponent("cc.Toggle").isChecked="quality"==Z,this.nodeStability.getComponent("cc.Toggle").isChecked="stability"==Z,l(n.URLID)}},onWelcome:function(){ee||(0==_.active?_.active=!0:j&&(_.active=!1))},onSketchDenoising:function(e,t){Y=e.isChecked?"true":"false"},onResultDenoising:function(e,t){J=e.isChecked?"true":"false"},onLoad:function(){cc.director.setClearColor(cc.color(0,0,0,0)),p=this.sketchImg.getComponent("cc.Sprite"),u=this.referenceImg.getComponent("cc.Sprite"),g=this.resultImg.getComponent("cc.Sprite"),f=this.colorImg.getComponent("cc.Sprite"),m=this.hint,R=this.view,C=this.btn.getComponent("cc.Button"),y=this.btn.getComponent("cc.RichText"),L=g.spriteFrame.getTexture(),(w=document.createElement("input")).id="fileInputForSketch",w.type="file",w.accept="image/*",w.style.height="0px",w.style.display="block",w.style.overflow="hidden",document.body.insertBefore(w,document.body.firstChild),w.addEventListener("change",o,!1),(x=document.createElement("input")).id="fileInputForReferene",x.type="file",x.accept="image/*",x.style.height="0px",x.style.display="block",x.style.overflow="hidden",document.body.insertBefore(x,document.body.firstChild),x.addEventListener("change",c,!1),this.node.on("mousemove",function(e){v=e.getLocation()}),this.node.on("mousedown",function(e){z=!0}),this.node.on("mouseup",function(e){E=!0,z=!1}),(b=document.createElement("canvas")).id="HTML_Canvas_hint",(T=document.createElement("canvas")).id="HTML_Canvas_reference",(F=document.createElement("canvas")).id="HTML_Canvas_sketch",k=this.quickBTN,S=this.waiting,_=this.welcome,this.quickBTN.opacity=0,this.waiting.opacity=0,N=!0},onSketchClicked:function(){ee||w.click()},onRefenceClicked:function(){ee||x.click()},onPenClicked:function(){P=!0},onEraserClicked:function(){P=!1},onClearClicked:function(){b.getContext("2d").clearRect(0,0,b.width,b.height);var e=m.getComponent("cc.Sprite").spriteFrame.getTexture();e.initWithElement(b),e.handleLoadedTexture()},disableAll:function(){ee=!0,this.waiting.opacity=255,this.quickBTN.opacity=0,C.enabled=!1,te=null,""==V&&(V=y.string),y.string=this.loading},onColorizeClicked:function(){if(!ee&&H&&j){this.disableAll();var e=b.toDataURL("image/png"),t=T.toDataURL("image/png"),n=F.toDataURL("image/png"),i=new XMLHttpRequest;i.open("POST","/paint",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),i.onreadystatechange=function(){s(i.responseText)},"new"!=A&&(n="null"),"new"!=G&&(t="null"),i.send("sketch="+encodeURIComponent(n)+"&reference="+encodeURIComponent(t)+"&hint="+encodeURIComponent(e)+"&sketchDenoise="+Y+"&resultDenoise="+J+"&algrithom="+Z+"&method="+Q+"&sketchID="+A+"&referenceID="+G),console.log("sended")}},onDownloadClicked:function(){""!=K&&window.open(K)},handlePainter:function(){O=!1;var e=0,t=0,n=p.node.convertToWorldSpace(p.node.position);if(null!=n&&null!=v&&(e=v.x-n.x,t=v.y-n.y,e>0&&t>0&&e<p.node.width&&t<p.node.height&&(O=!0)),O&&z){var i=b.getContext("2d");if(P){i.beginPath(),i.fillRect(parseInt(parseFloat(e)/parseFloat(m.width)*parseFloat(b.width))-2,parseInt(parseFloat(m.height-t)/parseFloat(m.height)*parseFloat(b.height))-2,5,5),i.closePath();var o=f.node.color;i.fillStyle="rgba("+o.r.toString()+","+o.g.toString()+","+o.b.toString()+",1.0)",i.fill()}else(i=b.getContext("2d")).clearRect(parseInt(parseFloat(e)/parseFloat(m.width)*parseFloat(b.width))-10,parseInt(parseFloat(m.height-t)/parseFloat(m.height)*parseFloat(b.height))-10,20,20);var c=m.getComponent("cc.Sprite").spriteFrame.getTexture();c.initWithElement(b),c.handleLoadedTexture(!0)}},handleColorPicker:function(){var e=u.node.convertToWorldSpace(u.node.position);if(null!=e&&null!=v){var t=e.x,n=e.y,i=v.x-t,o=v.y-n;if(D=i>0&&o>0&&i<u.node.width&&o<u.node.height)B||(U=!0),E&&U&&(this.flag.x=i-u.node.width/2,this.flag.y=o-u.node.height/2,q=i,W=o);else if(U){U=!1;u.spriteFrame.getTexture();f.node.color=u.spriteFrame.getTexture().getPixels(q,W,u.node.width,u.node.height)}if(U){u.spriteFrame.getTexture();f.node.color=u.spriteFrame.getTexture().getPixels(i,o,u.node.width,u.node.height)}}},update:function(e){N&&(this.handleColorPicker(),this.handlePainter(),document.body.style.cursor=U?"crosshair":O?"crosshair":"default"),B=D,E=!1;var t=parseFloat(X),n=parseFloat($),i=parseFloat(R.width-64)/t,o=parseFloat(R.height)/n,c=Math.min(i,o);t*=c,n*=c,p.node.width=parseInt(t),p.node.height=parseInt(n),m.width=parseInt(t),m.height=parseInt(n),g.node.width=parseInt(t),g.node.height=parseInt(n),0==C.enabled&&null!=te&&te.isLoaded()&&(g.spriteFrame.setTexture(te),C.enabled=!0,y.string=V,V="",A=I[0],G=I[1],this.waiting.opacity=0,this.quickBTN.opacity=255,ee=!1),ne&&j&&H&&M&&(ne=!1,I=new Array("new","new"),te=cc.textureCache.addImage(K))}}),cc._RF.pop()},{}],friendBTN:[function(e,t,n){"use strict";cc._RF.push(t,"89bbbt2755B+KUc2xfqGh2x","friendBTN"),cc.Class({extends:cc.Component,properties:{self:{default:null,type:cc.Button},other:{default:null,type:cc.Button}},shifter:function(){this.self.interactable=!1,this.other.interactable=!0}}),cc._RF.pop()},{}],interLabelraw:[function(e,t,n){"use strict";cc._RF.push(t,"3022cUZjkhO6Kb/VeKpEDgk","interLabelraw"),cc.Class({extends:cc.Component,properties:{chinese:{default:"",type:cc.String,multiline:!0},japanese:{default:"",type:cc.String,multiline:!0},english:{default:"",type:cc.String,multiline:!0}},chinese_shift:function(){this.getComponent("cc.Label").string=this.chinese},english_shift:function(){this.getComponent("cc.Label").string=this.english},japanese_shift:function(){this.getComponent("cc.Label").string=this.japanese}}),cc._RF.pop()},{}],interLabel:[function(e,t,n){"use strict";cc._RF.push(t,"a8741dMb/5JTYqaaFU1+v7G","interLabel"),cc.Class({extends:cc.Component,properties:{chinese:{default:"",type:cc.String},japanese:{default:"",type:cc.String},english:{default:"",type:cc.String}},chinese_shift:function(){this.getComponent("cc.RichText").string=this.chinese},english_shift:function(){this.getComponent("cc.RichText").string=this.english},japanese_shift:function(){this.getComponent("cc.RichText").string=this.japanese}}),cc._RF.pop()},{}],language:[function(e,t,n){"use strict";cc._RF.push(t,"43eed/FNLJL8abf9CYtrkGJ","language"),cc.Class({extends:cc.Component,chinese:function(){console.log("chinese");for(var e=this.getComponentsInChildren("interLabel"),t=0;t<e.length;t++)e[t].chinese_shift();e=this.getComponentsInChildren("interLabelraw");for(t=0;t<e.length;t++)e[t].chinese_shift()},japanese:function(){console.log("japanese");for(var e=this.getComponentsInChildren("interLabel"),t=0;t<e.length;t++)e[t].japanese_shift();e=this.getComponentsInChildren("interLabelraw");for(t=0;t<e.length;t++)e[t].japanese_shift()},english:function(){console.log("english");for(var e=this.getComponentsInChildren("interLabel"),t=0;t<e.length;t++)e[t].english_shift();e=this.getComponentsInChildren("interLabelraw");for(t=0;t<e.length;t++)e[t].english_shift()},onLoad:function(){this.english(),"zh"==navigator.language.substring(0,2)&&this.chinese(),"ja"==navigator.language.substring(0,2)&&this.japanese()}}),cc._RF.pop()},{}],openURL:[function(e,t,n){"use strict";cc._RF.push(t,"2d711SvFglI2LFM/wHKq2Rc","openURL"),cc.Class({extends:cc.Component,properties:{url:{default:"",type:String}},onOpen:function(){window.open(this.url)}}),cc._RF.pop()},{}],sampler:[function(e,t,n){"use strict";cc._RF.push(t,"ea28egw6NtGzZKQa6tO9Dr3","sampler"),cc.Class({extends:cc.Component,properties:{URLID:{default:"",type:cc.String},sketchDenoise:{default:"",type:cc.String},resultDenoise:{default:"",type:cc.String},method:{default:"",type:cc.String},algrithom:{default:"",type:cc.String}}}),cc._RF.pop()},{}],subWidth:[function(e,t,n){"use strict";cc._RF.push(t,"34a72PKo4VOC43DYAdYfNnu","subWidth"),cc.Class({extends:cc.Component,properties:{A:{default:null,type:cc.Node},B:{default:null,type:cc.Node}},update:function(e){this.node.width=this.A.width-this.B.width}}),cc._RF.pop()},{}]},{},["Controller","friendBTN","interLabel","interLabelraw","language","openURL","sampler","subWidth"]);