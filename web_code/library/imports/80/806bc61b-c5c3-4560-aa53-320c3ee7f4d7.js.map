{"version":3,"sources":["assets\\script\\Controller.js"],"names":["spSketchImg","spRefereneImg","spResultImg","spColorImg","spHintNode","spBTN","spLAB","fileInputForSketch","fileInputForReferene","mousePosition","mouseInReference","loaded","getMouseDown","preMouseInRef","selectingColor","painting","finalX","finalY","hasSketch","hasRef","HTML_Canvas_sketch","HTML_Canvas_reference","HTML_Canvas_hint","isPen","mouseIsDown","sketchID","tempSketchID","resultURL","version","createObjectURL","blob","window","URL","undefined","onSketchFileSelected","evt","loadLocalSketch","target","files","onRefereneFileSelected","loadLocalReference","uri","tempDiv","document","getElementById","createElement","body","appendChild","style","position","id","innerHTML","display","visibility","img","onload","w_224","parseFloat","width","h_224","height","w_200","h_200","node","parseInt","getContext","drawImage","clearRect","referenceNodeTexture","spriteFrame","getTexture","hintNodeTexture","getComponent","initWithElement","handleLoadedTexture","tempCanvas_200","_pixels","getImageData","data","src","loadLocalResult","texture","w","h","small","enabled","string","sketchNodeTexture","cc","Texture2D","prototype","getPixels","x","y","newWidth","newHeight","idx","color","Class","extends","Component","properties","sketchImg","default","type","Node","referenceImg","resultImg","colorImg","flag","hint","btn","denoise","welcome","onV1","onClearClicked","onV2","onV3","onV4","onLoad","director","setClearColor","accept","overflow","insertBefore","firstChild","addEventListener","on","event","getLocation","onSketchClicked","click","onRefenceClicked","onPenClicked","onEraserClicked","cxt","hintNodeTex","onColorizeClicked","hintDataURL","toDataURL","referenceDataURL","sketchDataURL","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","responseText","send","encodeURIComponent","toString","isChecked","active","onDownloadClicked","handlePainter","relativeX","relativeY","refPosition","convertToWorldSpace","beginX","beginY","mouseInSketch","pen","beginPath","arc","Math","PI","closePath","fillStyle","r","g","b","fill","handleColorPicker","update","dt","cursor"],"mappings":"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","file":"unknown","sourcesContent":["var spSketchImg;\r\nvar spRefereneImg;\r\nvar spResultImg;\r\nvar spColorImg;\r\nvar spHintNode;\r\nvar spBTN;\r\nvar spLAB;\r\n\r\nvar fileInputForSketch;\r\nvar fileInputForReferene;\r\n\r\nvar mousePosition;\r\nvar mouseInReference = false;\r\n\r\nvar loaded = false;\r\n\r\nvar getMouseDown = false;\r\nvar preMouseInRef = false;\r\nvar selectingColor = false;\r\nvar painting = false;\r\nvar finalX=0;\r\nvar finalY=0;\r\n\r\nvar hasSketch=false;\r\nvar hasRef=false;\r\n\r\nvar HTML_Canvas_sketch;\r\nvar HTML_Canvas_reference;\r\nvar HTML_Canvas_hint;\r\n\r\nvar isPen = true;\r\n\r\nvar mouseIsDown = false;\r\n\r\nvar sketchID = \"new\";\r\nvar tempSketchID = \"new\";\r\n\r\nvar resultURL = \"\";\r\n\r\nvar version = 2;\r\n\r\nfunction createObjectURL(blob){\r\n    if(window.URL !== undefined)\r\n        return window['URL']['createObjectURL'](blob);\r\n    else\r\n        return window['webkitURL']['createObjectURL'](blob);\r\n}\r\n\r\nfunction onSketchFileSelected(evt) {\r\n    loadLocalSketch(createObjectURL(evt.target.files[0]));\r\n}\r\n\r\nfunction onRefereneFileSelected(evt) {\r\n    loadLocalReference(createObjectURL(evt.target.files[0]));\r\n}\r\n\r\nfunction loadLocalReference(uri){\r\n    var tempDiv = document.getElementById(\"tempDivReference\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivReference\";\r\n        tempDiv.innerHTML = '<img id=imgheadReference>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadReference');\r\n    img.onload = function(){\r\n        \r\n        var w_224 = parseFloat(this.width);\r\n\t\tvar h_224 = parseFloat(this.height);\r\n\t\tif(w_224 > h_224)\r\n\t\t{\r\n\t\t    w_224 = 224.0 / h_224 * w_224;\r\n\t\t    h_224 = 224.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h_224 = 224.0 / w_224 * h_224;\r\n\t\t    w_224 = 224.0;\r\n\t\t}\r\n\t\t\r\n\t\tvar w_200 = parseFloat(this.width);\r\n\t\tvar h_200 = parseFloat(this.height);\r\n\t\tif(w_200 < h_200)\r\n\t\t{\r\n\t\t    w_200 = 200.0 / h_200 * w_200;\r\n\t\t    h_200 = 200.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h_200 = 200.0 / w_200 * h_200;\r\n\t\t    w_200 = 200.0;\r\n\t\t}\r\n\t\t\r\n\t\tspRefereneImg.node.width = parseInt(w_200);\r\n\t\tspRefereneImg.node.height = parseInt(h_200);\r\n\t\tHTML_Canvas_reference.width = parseInt(w_224);\r\n        HTML_Canvas_reference.height = parseInt(h_224);\r\n        \r\n        HTML_Canvas_reference.getContext(\"2d\").drawImage(this, 0, 0, HTML_Canvas_reference.width, HTML_Canvas_reference.height);\r\n        HTML_Canvas_hint.getContext(\"2d\").clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n        \r\n        var referenceNodeTexture = spRefereneImg.spriteFrame.getTexture();\r\n\t\tvar hintNodeTexture = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n        \r\n\t\thintNodeTexture.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\treferenceNodeTexture.initWithElement(HTML_Canvas_reference);\r\n\t\treferenceNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\tvar tempCanvas_200 = document.createElement(\"canvas\");\r\n        tempCanvas_200.width = parseInt(w_200);\r\n        tempCanvas_200.height = parseInt(h_200);\r\n        tempCanvas_200.getContext(\"2d\").drawImage(this, 0, 0, tempCanvas_200.width, tempCanvas_200.height);\r\n        referenceNodeTexture._pixels = tempCanvas_200.getContext(\"2d\").getImageData(0, 0, tempCanvas_200.width, tempCanvas_200.height).data;\r\n\t\t\r\n\t\thasRef = true;\r\n    }\r\n\timg.src = uri;\r\n}\r\n\r\nfunction loadLocalResult(uri){\r\n    var tempDiv = document.getElementById(\"tempDivResult\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivResult\";\r\n        tempDiv.innerHTML = '<img id=imgheadResult>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadResult');\r\n    img.onload = function(){\r\n        \r\n\t\tvar texture = spResultImg.spriteFrame.getTexture();\r\n\t\ttexture.initWithElement(this);\r\n\t\ttexture.handleLoadedTexture();\r\n\t\tvar w = parseFloat(this.width);\r\n\t\tvar h = parseFloat(this.height);\r\n\t\t\r\n\t\tvar small = true;\r\n\t\t\r\n\t\tif(w>h){\r\n\t\t    if(w>724){\r\n\t\t        small = false;\r\n\t\t    }\r\n\t\t}else{\r\n\t\t    if(h>724){\r\n\t\t        small = false;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tif(!small){\r\n\t\t    if(w<h)\r\n\t\t    {\r\n\t\t        w = 724.0 / h * w;\r\n\t\t        h = 724.0;\r\n\t\t    }\r\n\t\t    else\r\n\t\t    {\r\n\t\t        h = 724.0 / w * h;\r\n\t\t        w = 724.0;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tspResultImg.node.width = parseInt(w);\r\n\t\tspResultImg.node.height = parseInt(h);\r\n\t\t\r\n\t\tspBTN.enabled = true;\r\n        spLAB.string = \"<u>colorize</u>\";\r\n        \r\n        sketchID = tempSketchID;\r\n    }\r\n    tempSketchID = uri\r\n    resultURL = \"results/\" + tempSketchID + \".jpg\";\r\n\timg.src = resultURL;\r\n}\r\n\r\nfunction loadLocalSketch(uri){\r\n    var tempDiv = document.getElementById(\"tempDivSketch\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivSketch\";\r\n        tempDiv.innerHTML = '<img id=imgheadSketch>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadSketch');\r\n    img.onload = function(){\r\n        \r\n        var w = parseFloat(this.width);\r\n\t\tvar h = parseFloat(this.height);\r\n\t\t\r\n\t\tif(h<w){\r\n\t\t    if(h>1024){\r\n\t\t        w = 1024.0 / h * w;\r\n\t\t        h = 1024.0;\r\n\t\t    }\r\n\t\t}else{\r\n\t\t    if(w>1024){\r\n\t\t        h = 1024.0 / w * h;\r\n\t\t        w = 1024.0;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tHTML_Canvas_sketch.width = parseInt(w);\r\n        HTML_Canvas_sketch.height = parseInt(h);\r\n        \r\n\t\tif(w > h)\r\n\t\t{\r\n\t\t    w = 512.0 / h * w;\r\n\t\t    h = 512.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h = 512.0 / w * h;\r\n\t\t    w = 512.0;\r\n\t\t}\r\n        \r\n        HTML_Canvas_hint.width = parseInt(w);\r\n\t\tHTML_Canvas_hint.height = parseInt(h);\r\n        \r\n\t\tw = parseFloat(this.width);\r\n\t\th = parseFloat(this.height);\r\n\t\tif(w < h)\r\n\t\t{\r\n\t\t    w = 512.0 / h * w;\r\n\t\t    h = 512.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h = 512.0 / w * h;\r\n\t\t    w = 512.0;\r\n\t\t}\r\n\t\t\r\n\t\tspSketchImg.node.width = parseInt(w);\r\n\t\tspSketchImg.node.height = parseInt(h);\r\n\t\tspHintNode.width = parseInt(w);\r\n\t\tspHintNode.height = parseInt(h);\r\n\r\n        HTML_Canvas_sketch.getContext(\"2d\").drawImage(this, 0, 0, HTML_Canvas_sketch.width, HTML_Canvas_sketch.height);\r\n\t    HTML_Canvas_hint.getContext(\"2d\").clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n\t    \r\n        var hintNodeTexture = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n\t\thintNodeTexture.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\tvar sketchNodeTexture = spSketchImg.spriteFrame.getTexture();\r\n\t\tsketchNodeTexture.initWithElement(HTML_Canvas_sketch);\r\n\t\tsketchNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\thasSketch = true;\r\n\t\tsketchID = \"new\";\r\n    }\r\n\timg.src = uri;\r\n}\r\n\r\ncc.Texture2D.prototype._pixels = [];\r\ncc.Texture2D.prototype.getPixels = function(x,y,newWidth,newHeight){\r\n    var idx = parseInt((newHeight-parseInt(y)) * newWidth * 4 + parseInt(x) * 4);\r\n    return new cc.color(this._pixels[idx],this._pixels[idx + 1],this._pixels[idx + 2]);\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        sketchImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        referenceImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        resultImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        colorImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        flag:{\r\n            default:null,type:cc.Node\r\n        },\r\n        hint:{\r\n            default:null,type:cc.Node\r\n        },\r\n        btn:{\r\n            default:null,type:cc.Node\r\n        },\r\n        denoise:{\r\n            default:null,type:cc.Node\r\n        },\r\n        welcome:{\r\n            default:null,type:cc.Node\r\n        },\r\n    },\r\n    \r\n    onV1: function(){\r\n        version = 1;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV2: function(){\r\n        version = 2;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV3: function(){\r\n        version = 3;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV4: function(){\r\n        version = 4;\r\n        this.onClearClicked();\r\n    },\r\n\r\n    onLoad: function () {\r\n        \r\n        cc.director.setClearColor(cc.color(0, 0, 0, 0))\r\n        \r\n        spSketchImg = this.sketchImg.getComponent('cc.Sprite');\r\n        spRefereneImg = this.referenceImg.getComponent('cc.Sprite');\r\n        spResultImg = this.resultImg.getComponent('cc.Sprite');\r\n        spColorImg = this.colorImg.getComponent('cc.Sprite');\r\n        spHintNode = this.hint;\r\n        spBTN = this.btn.getComponent('cc.Button');\r\n        spLAB = this.btn.getComponent('cc.RichText');\r\n        \r\n        fileInputForSketch = document.createElement(\"input\");\r\n        fileInputForSketch.id = \"fileInputForSketch\";\r\n        fileInputForSketch.type = \"file\";\r\n        fileInputForSketch.accept = \"image/*\";\r\n        fileInputForSketch.style.height = \"0px\";\r\n        fileInputForSketch.style.display = \"block\";\r\n        fileInputForSketch.style.overflow = \"hidden\";\r\n        document.body.insertBefore(fileInputForSketch,document.body.firstChild);\r\n        fileInputForSketch.addEventListener('change', onSketchFileSelected, false);\r\n        \r\n        fileInputForReferene = document.createElement(\"input\");\r\n        fileInputForReferene.id = \"fileInputForReferene\";\r\n        fileInputForReferene.type = \"file\";\r\n        fileInputForReferene.accept = \"image/*\";\r\n        fileInputForReferene.style.height = \"0px\";\r\n        fileInputForReferene.style.display = \"block\";\r\n        fileInputForReferene.style.overflow = \"hidden\";\r\n        document.body.insertBefore(fileInputForReferene,document.body.firstChild);\r\n        fileInputForReferene.addEventListener('change', onRefereneFileSelected, false);\r\n        \r\n        this.node.on(\"mousemove\", function (event) { \r\n            mousePosition = event.getLocation();\r\n        });\r\n        \r\n        this.node.on(\"mousedown\", function (event) { \r\n            mouseIsDown = true;\r\n        });\r\n        \r\n        this.node.on(\"mouseup\", function (event) { \r\n            getMouseDown = true;\r\n            mouseIsDown = false;\r\n        });\r\n        \r\n        HTML_Canvas_hint = document.createElement(\"canvas\");\r\n        HTML_Canvas_hint.id = \"HTML_Canvas_hint\";\r\n        \r\n        HTML_Canvas_reference = document.createElement(\"canvas\");\r\n        HTML_Canvas_reference.id = \"HTML_Canvas_reference\";\r\n        \r\n        HTML_Canvas_sketch = document.createElement(\"canvas\");\r\n        HTML_Canvas_sketch.id = \"HTML_Canvas_sketch\";\r\n        \r\n        loaded = true;\r\n        \r\n    },\r\n    \r\n    onSketchClicked: function(){\r\n        fileInputForSketch.click();\r\n    },\r\n    onRefenceClicked: function(){\r\n        fileInputForReferene.click();\r\n    },\r\n    onPenClicked: function(){\r\n        isPen = true;\r\n    },\r\n    onEraserClicked: function(){\r\n        isPen = false;\r\n    },\r\n    onClearClicked: function(){\r\n        var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n\t    cxt.clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n        var hintNodeTex = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n\t\thintNodeTex.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTex.handleLoadedTexture();\r\n    },\r\n    onColorizeClicked: function(){\r\n        if(!hasRef){\r\n            return;\r\n        }\r\n        if(!hasSketch){\r\n            return;\r\n        }\r\n        \r\n        spResultImg.node.width = 0;\r\n        spResultImg.node.height = 0;\r\n        \r\n        var hintDataURL = HTML_Canvas_hint.toDataURL(\"image/png\");\r\n        var referenceDataURL = HTML_Canvas_reference.toDataURL(\"image/png\");\r\n        var sketchDataURL = HTML_Canvas_sketch.toDataURL(\"image/png\");\r\n        \r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"POST\", \"/paint\", true);\r\n        xhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded;\");\r\n        xhr.onreadystatechange = function() {\r\n            loadLocalResult(xhr.responseText);\r\n        };\r\n        if(sketchID!=\"new\"){\r\n            sketchDataURL = \"null\";\r\n        }\r\n        xhr.send\r\n            (\r\n            \"sketch=\"+encodeURIComponent(sketchDataURL)+\r\n            \"&reference=\"+encodeURIComponent(referenceDataURL)+\r\n            \"&hint=\"+encodeURIComponent(hintDataURL)+\r\n            \"&version=\"+version.toString()+\r\n            \"&denoise=\"+this.denoise.getComponent('cc.Toggle').isChecked.toString()+\r\n            \"&sketchID=\"+sketchID\r\n            );\r\n        spBTN.enabled = false;\r\n        spLAB.string = \"Waiting\";\r\n        this.welcome.active = false;\r\n    },\r\n    onDownloadClicked: function(){\r\n        if(resultURL==\"\"){\r\n            return;\r\n        }\r\n        window.open(resultURL);\r\n    },\r\n    handlePainter: function(){\r\n        painting = false;\r\n        var relativeX = 0;\r\n        var relativeY = 0;\r\n        var refPosition = spSketchImg.node.convertToWorldSpace(spSketchImg.node.position);\r\n        if(refPosition != null && mousePosition != null){\r\n            var beginX = refPosition.x - 256;\r\n            var beginY = refPosition.y - 256;\r\n            relativeX = mousePosition.x - beginX;\r\n            relativeY = mousePosition.y - beginY;\r\n            var mouseInSketch = (relativeX > 0 && relativeY > 0 && relativeX < spSketchImg.node.width && relativeY < spSketchImg.node.height);\r\n            if(mouseInSketch){\r\n                painting = true;\r\n            }\r\n        }\r\n        if(painting){\r\n            if(mouseIsDown){\r\n                var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n                \r\n                if(isPen){\r\n                    var pen = 6 - version;\r\n                    cxt.beginPath();\r\n                    cxt.arc(parseInt(parseFloat(relativeX) / parseFloat(spHintNode.width) * parseFloat(HTML_Canvas_hint.width)), parseInt(parseFloat(spHintNode.height - relativeY) / parseFloat(spHintNode.height) * parseFloat(HTML_Canvas_hint.height)), pen, 0, Math.PI * 2, true);\r\n                    cxt.closePath();\r\n                    var color = spColorImg.node.color\r\n                    cxt.fillStyle = 'rgba('+color.r.toString()+','+color.g.toString()+','+color.b.toString()+',0.618)';\r\n                    cxt.fill();\r\n                }else{\r\n                    var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n                    cxt.clearRect(parseInt(parseFloat(relativeX) / parseFloat(spHintNode.width) * parseFloat(HTML_Canvas_hint.width)) - 10, parseInt(parseFloat(spHintNode.height - relativeY) / parseFloat(spHintNode.height) * parseFloat(HTML_Canvas_hint.height)) - 10,20,20);\r\n                }\r\n                \r\n                var hintNodeTex = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n                hintNodeTex.initWithElement(HTML_Canvas_hint);\r\n                hintNodeTex.handleLoadedTexture(true);\r\n            }\r\n        }\r\n    },\r\n    handleColorPicker: function(){\r\n        var refPosition = spRefereneImg.node.convertToWorldSpace(spRefereneImg.node.position);\r\n            if(refPosition != null && mousePosition != null){\r\n                var beginX = refPosition.x;\r\n                var beginY = refPosition.y;\r\n                var relativeX = mousePosition.x - beginX;\r\n                var relativeY = mousePosition.y - beginY;\r\n                mouseInReference = (relativeX > 0 && relativeY > 0 && relativeX < spRefereneImg.node.width && relativeY < spRefereneImg.node.height);\r\n                if(mouseInReference){\r\n                    if(!preMouseInRef){\r\n                        selectingColor = true;\r\n                    }\r\n                    if(getMouseDown){\r\n                        if(selectingColor){\r\n                        this.flag.x = relativeX - spRefereneImg.node.width / 2;\r\n                        this.flag.y = relativeY - spRefereneImg.node.height / 2;\r\n                        finalX = relativeX;\r\n                        finalY = relativeY;\r\n                        isPen = true;\r\n                        }\r\n                    }\r\n                }else{\r\n                    if(selectingColor){\r\n                        selectingColor = false;\r\n                        var texture = spRefereneImg.spriteFrame.getTexture();\r\n                        spColorImg.node.color = spRefereneImg.spriteFrame.getTexture().getPixels(finalX,finalY,spRefereneImg.node.width,spRefereneImg.node.height);\r\n                    }\r\n                }\r\n                if(selectingColor){\r\n                    var texture = spRefereneImg.spriteFrame.getTexture();\r\n                    spColorImg.node.color = spRefereneImg.spriteFrame.getTexture().getPixels(relativeX,relativeY,spRefereneImg.node.width,spRefereneImg.node.height);\r\n                }\r\n            }\r\n    },\r\n    update: function (dt) {\r\n        if(loaded){\r\n            this.handleColorPicker();\r\n            this.handlePainter();\r\n            if(selectingColor)\r\n            {\r\n                document.body.style.cursor='crosshair';\r\n            }\r\n            else if(painting)\r\n            {\r\n                document.body.style.cursor='crosshair';\r\n            }\r\n            else\r\n            {\r\n                document.body.style.cursor='default';\r\n            }\r\n        }\r\n        preMouseInRef = mouseInReference;\r\n        getMouseDown = false;\r\n    },\r\n});\r\n"]}