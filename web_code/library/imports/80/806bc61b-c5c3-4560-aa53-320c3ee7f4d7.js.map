{"version":3,"sources":["assets\\script\\Controller.js"],"names":["spSketchImg","spRefereneImg","spResultImg","spColorImg","spHintNode","spBTN","spLAB","fileInputForSketch","fileInputForReferene","mousePosition","mouseInReference","loaded","getMouseDown","preMouseInRef","selectingColor","painting","finalX","finalY","hasSketch","hasRef","HTML_Canvas_sketch","HTML_Canvas_reference","HTML_Canvas_hint","isPen","mouseIsDown","sketchID","referenceID","tempID","resultURL","version","createObjectURL","blob","window","URL","undefined","onSketchFileSelected","evt","loadLocalSketch","target","files","onRefereneFileSelected","loadLocalReference","uri","tempDiv","document","getElementById","createElement","body","appendChild","style","position","id","innerHTML","display","visibility","img","onload","w_224","parseFloat","width","h_224","height","w_200","h_200","node","parseInt","getContext","drawImage","clearRect","referenceNodeTexture","spriteFrame","getTexture","hintNodeTexture","getComponent","initWithElement","handleLoadedTexture","tempCanvas_200","_pixels","getImageData","data","src","loadLocalResult","texture","w","h","small","enabled","string","split","length","Math","random","toString","sketchNodeTexture","cc","Texture2D","prototype","getPixels","x","y","newWidth","newHeight","idx","color","Class","extends","Component","properties","sketchImg","default","type","Node","referenceImg","resultImg","colorImg","flag","hint","btn","denoise","welcome","onV1","onClearClicked","onV2","onV3","onV4","onLoad","director","setClearColor","accept","overflow","insertBefore","firstChild","addEventListener","on","event","getLocation","onSketchClicked","click","onRefenceClicked","onPenClicked","onEraserClicked","cxt","hintNodeTex","onColorizeClicked","hintDataURL","toDataURL","referenceDataURL","sketchDataURL","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","responseText","send","encodeURIComponent","isChecked","active","onDownloadClicked","handlePainter","relativeX","relativeY","refPosition","convertToWorldSpace","beginX","beginY","mouseInSketch","pen","beginPath","arc","PI","closePath","fillStyle","r","g","b","fill","handleColorPicker","update","dt","cursor"],"mappings":"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","file":"unknown","sourcesContent":["var spSketchImg;\r\nvar spRefereneImg;\r\nvar spResultImg;\r\nvar spColorImg;\r\nvar spHintNode;\r\nvar spBTN;\r\nvar spLAB;\r\n\r\nvar fileInputForSketch;\r\nvar fileInputForReferene;\r\n\r\nvar mousePosition;\r\nvar mouseInReference = false;\r\n\r\nvar loaded = false;\r\n\r\nvar getMouseDown = false;\r\nvar preMouseInRef = false;\r\nvar selectingColor = false;\r\nvar painting = false;\r\nvar finalX=0;\r\nvar finalY=0;\r\n\r\nvar hasSketch=false;\r\nvar hasRef=false;\r\n\r\nvar HTML_Canvas_sketch;\r\nvar HTML_Canvas_reference;\r\nvar HTML_Canvas_hint;\r\n\r\nvar isPen = true;\r\n\r\nvar mouseIsDown = false;\r\n\r\nvar sketchID = \"new\";\r\nvar referenceID = \"new\";\r\nvar tempID;\r\n\r\nvar resultURL = \"\";\r\n\r\nvar version = 2;\r\n\r\nfunction createObjectURL(blob){\r\n    if(window.URL !== undefined)\r\n        return window['URL']['createObjectURL'](blob);\r\n    else\r\n        return window['webkitURL']['createObjectURL'](blob);\r\n}\r\n\r\nfunction onSketchFileSelected(evt) {\r\n    loadLocalSketch(createObjectURL(evt.target.files[0]));\r\n}\r\n\r\nfunction onRefereneFileSelected(evt) {\r\n    loadLocalReference(createObjectURL(evt.target.files[0]));\r\n}\r\n\r\nfunction loadLocalReference(uri){\r\n    var tempDiv = document.getElementById(\"tempDivReference\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivReference\";\r\n        tempDiv.innerHTML = '<img id=imgheadReference>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadReference');\r\n    img.onload = function(){\r\n        \r\n        var w_224 = parseFloat(this.width);\r\n\t\tvar h_224 = parseFloat(this.height);\r\n\t\tif(w_224 > h_224)\r\n\t\t{\r\n\t\t    w_224 = 224.0 / h_224 * w_224;\r\n\t\t    h_224 = 224.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h_224 = 224.0 / w_224 * h_224;\r\n\t\t    w_224 = 224.0;\r\n\t\t}\r\n\t\t\r\n\t\tvar w_200 = parseFloat(this.width);\r\n\t\tvar h_200 = parseFloat(this.height);\r\n\t\tif(w_200 < h_200)\r\n\t\t{\r\n\t\t    w_200 = 200.0 / h_200 * w_200;\r\n\t\t    h_200 = 200.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h_200 = 200.0 / w_200 * h_200;\r\n\t\t    w_200 = 200.0;\r\n\t\t}\r\n\t\t\r\n\t\tspRefereneImg.node.width = parseInt(w_200);\r\n\t\tspRefereneImg.node.height = parseInt(h_200);\r\n\t\tHTML_Canvas_reference.width = parseInt(w_224);\r\n        HTML_Canvas_reference.height = parseInt(h_224);\r\n        \r\n        HTML_Canvas_reference.getContext(\"2d\").drawImage(this, 0, 0, HTML_Canvas_reference.width, HTML_Canvas_reference.height);\r\n        HTML_Canvas_hint.getContext(\"2d\").clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n        \r\n        var referenceNodeTexture = spRefereneImg.spriteFrame.getTexture();\r\n\t\tvar hintNodeTexture = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n        \r\n\t\thintNodeTexture.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\treferenceNodeTexture.initWithElement(HTML_Canvas_reference);\r\n\t\treferenceNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\tvar tempCanvas_200 = document.createElement(\"canvas\");\r\n        tempCanvas_200.width = parseInt(w_200);\r\n        tempCanvas_200.height = parseInt(h_200);\r\n        tempCanvas_200.getContext(\"2d\").drawImage(this, 0, 0, tempCanvas_200.width, tempCanvas_200.height);\r\n        referenceNodeTexture._pixels = tempCanvas_200.getContext(\"2d\").getImageData(0, 0, tempCanvas_200.width, tempCanvas_200.height).data;\r\n\t\t\r\n\t\thasRef = true;\r\n\t\treferenceID = \"new\";\r\n    }\r\n\timg.src = uri;\r\n}\r\n\r\nfunction loadLocalResult(uri){\r\n    var tempDiv = document.getElementById(\"tempDivResult\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivResult\";\r\n        tempDiv.innerHTML = '<img id=imgheadResult>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadResult');\r\n    img.onload = function(){\r\n        \r\n\t\tvar texture = spResultImg.spriteFrame.getTexture();\r\n\t\ttexture.initWithElement(this);\r\n\t\ttexture.handleLoadedTexture();\r\n\t\tvar w = parseFloat(this.width);\r\n\t\tvar h = parseFloat(this.height);\r\n\t\t\r\n\t\tvar small = true;\r\n\t\t\r\n\t\tif(w>h){\r\n\t\t    if(w>724){\r\n\t\t        small = false;\r\n\t\t    }\r\n\t\t}else{\r\n\t\t    if(h>724){\r\n\t\t        small = false;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tif(!small){\r\n\t\t    if(w<h)\r\n\t\t    {\r\n\t\t        w = 724.0 / h * w;\r\n\t\t        h = 724.0;\r\n\t\t    }\r\n\t\t    else\r\n\t\t    {\r\n\t\t        h = 724.0 / w * h;\r\n\t\t        w = 724.0;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tspResultImg.node.width = parseInt(w);\r\n\t\tspResultImg.node.height = parseInt(h);\r\n\t\t\r\n\t\tspBTN.enabled = true;\r\n        spLAB.string = \"<u>colorize</u>\";\r\n        \r\n        sketchID = tempID[0];\r\n        referenceID = tempID[1];\r\n    }\r\n    tempID = uri.split(\"*\");\r\n    if(tempID.length==2){\r\n        resultURL = \"results/\" + tempID[0] + \".jpg?t=\" + Math.random().toString();\r\n\t    img.src = resultURL;\r\n    }else{\r\n        spBTN.enabled = true;\r\n        spLAB.string = \"<u>colorize</u>\";\r\n    }\r\n}\r\n\r\nfunction loadLocalSketch(uri){\r\n    var tempDiv = document.getElementById(\"tempDivSketch\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivSketch\";\r\n        tempDiv.innerHTML = '<img id=imgheadSketch>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadSketch');\r\n    img.onload = function(){\r\n        \r\n        var w = parseFloat(this.width);\r\n\t\tvar h = parseFloat(this.height);\r\n\t\t\r\n\t\tif(h<w){\r\n\t\t    if(h>1024){\r\n\t\t        w = 1024.0 / h * w;\r\n\t\t        h = 1024.0;\r\n\t\t    }\r\n\t\t}else{\r\n\t\t    if(w>1024){\r\n\t\t        h = 1024.0 / w * h;\r\n\t\t        w = 1024.0;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tHTML_Canvas_sketch.width = parseInt(w);\r\n        HTML_Canvas_sketch.height = parseInt(h);\r\n        \r\n\t\tif(w > h)\r\n\t\t{\r\n\t\t    w = 512.0 / h * w;\r\n\t\t    h = 512.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h = 512.0 / w * h;\r\n\t\t    w = 512.0;\r\n\t\t}\r\n        \r\n        HTML_Canvas_hint.width = parseInt(w);\r\n\t\tHTML_Canvas_hint.height = parseInt(h);\r\n        \r\n\t\tw = parseFloat(this.width);\r\n\t\th = parseFloat(this.height);\r\n\t\tif(w < h)\r\n\t\t{\r\n\t\t    w = 512.0 / h * w;\r\n\t\t    h = 512.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h = 512.0 / w * h;\r\n\t\t    w = 512.0;\r\n\t\t}\r\n\t\t\r\n\t\tspSketchImg.node.width = parseInt(w);\r\n\t\tspSketchImg.node.height = parseInt(h);\r\n\t\tspHintNode.width = parseInt(w);\r\n\t\tspHintNode.height = parseInt(h);\r\n\r\n        HTML_Canvas_sketch.getContext(\"2d\").drawImage(this, 0, 0, HTML_Canvas_sketch.width, HTML_Canvas_sketch.height);\r\n\t    HTML_Canvas_hint.getContext(\"2d\").clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n\t    \r\n        var hintNodeTexture = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n\t\thintNodeTexture.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\tvar sketchNodeTexture = spSketchImg.spriteFrame.getTexture();\r\n\t\tsketchNodeTexture.initWithElement(HTML_Canvas_sketch);\r\n\t\tsketchNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\thasSketch = true;\r\n\t\tsketchID = \"new\";\r\n\t\treferenceID = \"new\";\r\n    }\r\n\timg.src = uri;\r\n}\r\n\r\ncc.Texture2D.prototype._pixels = [];\r\ncc.Texture2D.prototype.getPixels = function(x,y,newWidth,newHeight){\r\n    var idx = parseInt((newHeight-parseInt(y)) * newWidth * 4 + parseInt(x) * 4);\r\n    return new cc.color(this._pixels[idx],this._pixels[idx + 1],this._pixels[idx + 2]);\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        sketchImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        referenceImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        resultImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        colorImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        flag:{\r\n            default:null,type:cc.Node\r\n        },\r\n        hint:{\r\n            default:null,type:cc.Node\r\n        },\r\n        btn:{\r\n            default:null,type:cc.Node\r\n        },\r\n        denoise:{\r\n            default:null,type:cc.Node\r\n        },\r\n        welcome:{\r\n            default:null,type:cc.Node\r\n        },\r\n    },\r\n    \r\n    onV1: function(){\r\n        version = 1;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV2: function(){\r\n        version = 2;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV3: function(){\r\n        version = 3;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV4: function(){\r\n        version = 4;\r\n        this.onClearClicked();\r\n    },\r\n\r\n    onLoad: function () {\r\n        \r\n        cc.director.setClearColor(cc.color(0, 0, 0, 0))\r\n        \r\n        spSketchImg = this.sketchImg.getComponent('cc.Sprite');\r\n        spRefereneImg = this.referenceImg.getComponent('cc.Sprite');\r\n        spResultImg = this.resultImg.getComponent('cc.Sprite');\r\n        spColorImg = this.colorImg.getComponent('cc.Sprite');\r\n        spHintNode = this.hint;\r\n        spBTN = this.btn.getComponent('cc.Button');\r\n        spLAB = this.btn.getComponent('cc.RichText');\r\n        \r\n        fileInputForSketch = document.createElement(\"input\");\r\n        fileInputForSketch.id = \"fileInputForSketch\";\r\n        fileInputForSketch.type = \"file\";\r\n        fileInputForSketch.accept = \"image/*\";\r\n        fileInputForSketch.style.height = \"0px\";\r\n        fileInputForSketch.style.display = \"block\";\r\n        fileInputForSketch.style.overflow = \"hidden\";\r\n        document.body.insertBefore(fileInputForSketch,document.body.firstChild);\r\n        fileInputForSketch.addEventListener('change', onSketchFileSelected, false);\r\n        \r\n        fileInputForReferene = document.createElement(\"input\");\r\n        fileInputForReferene.id = \"fileInputForReferene\";\r\n        fileInputForReferene.type = \"file\";\r\n        fileInputForReferene.accept = \"image/*\";\r\n        fileInputForReferene.style.height = \"0px\";\r\n        fileInputForReferene.style.display = \"block\";\r\n        fileInputForReferene.style.overflow = \"hidden\";\r\n        document.body.insertBefore(fileInputForReferene,document.body.firstChild);\r\n        fileInputForReferene.addEventListener('change', onRefereneFileSelected, false);\r\n        \r\n        this.node.on(\"mousemove\", function (event) { \r\n            mousePosition = event.getLocation();\r\n        });\r\n        \r\n        this.node.on(\"mousedown\", function (event) { \r\n            mouseIsDown = true;\r\n        });\r\n        \r\n        this.node.on(\"mouseup\", function (event) { \r\n            getMouseDown = true;\r\n            mouseIsDown = false;\r\n        });\r\n        \r\n        HTML_Canvas_hint = document.createElement(\"canvas\");\r\n        HTML_Canvas_hint.id = \"HTML_Canvas_hint\";\r\n        \r\n        HTML_Canvas_reference = document.createElement(\"canvas\");\r\n        HTML_Canvas_reference.id = \"HTML_Canvas_reference\";\r\n        \r\n        HTML_Canvas_sketch = document.createElement(\"canvas\");\r\n        HTML_Canvas_sketch.id = \"HTML_Canvas_sketch\";\r\n        \r\n        loaded = true;\r\n        \r\n    },\r\n    \r\n    onSketchClicked: function(){\r\n        fileInputForSketch.click();\r\n    },\r\n    onRefenceClicked: function(){\r\n        fileInputForReferene.click();\r\n    },\r\n    onPenClicked: function(){\r\n        isPen = true;\r\n    },\r\n    onEraserClicked: function(){\r\n        isPen = false;\r\n    },\r\n    onClearClicked: function(){\r\n        var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n\t    cxt.clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n        var hintNodeTex = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n\t\thintNodeTex.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTex.handleLoadedTexture();\r\n    },\r\n    onColorizeClicked: function(){\r\n        if(!hasRef){\r\n            return;\r\n        }\r\n        if(!hasSketch){\r\n            return;\r\n        }\r\n        \r\n        spResultImg.node.width = 0;\r\n        spResultImg.node.height = 0;\r\n        \r\n        var hintDataURL = HTML_Canvas_hint.toDataURL(\"image/png\");\r\n        var referenceDataURL = HTML_Canvas_reference.toDataURL(\"image/png\");\r\n        var sketchDataURL = HTML_Canvas_sketch.toDataURL(\"image/png\");\r\n        \r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"POST\", \"/paint\", true);\r\n        xhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded;\");\r\n        xhr.onreadystatechange = function() {\r\n            loadLocalResult(xhr.responseText);\r\n        };\r\n        if(sketchID!=\"new\"){\r\n            sketchDataURL = \"null\";\r\n        }\r\n        if(referenceID!=\"new\"){\r\n            referenceDataURL = \"null\";\r\n        }\r\n        xhr.send\r\n            (\r\n            \"sketch=\"+encodeURIComponent(sketchDataURL)+\r\n            \"&reference=\"+encodeURIComponent(referenceDataURL)+\r\n            \"&hint=\"+encodeURIComponent(hintDataURL)+\r\n            \"&version=\"+version.toString()+\r\n            \"&denoise=\"+this.denoise.getComponent('cc.Toggle').isChecked.toString()+\r\n            \"&sketchID=\"+sketchID+\r\n            \"&referenceID=\"+referenceID\r\n            );\r\n        spBTN.enabled = false;\r\n        spLAB.string = \"Waiting\";\r\n        this.welcome.active = false;\r\n    },\r\n    onDownloadClicked: function(){\r\n        if(resultURL==\"\"){\r\n            return;\r\n        }\r\n        window.open(resultURL);\r\n    },\r\n    handlePainter: function(){\r\n        painting = false;\r\n        var relativeX = 0;\r\n        var relativeY = 0;\r\n        var refPosition = spSketchImg.node.convertToWorldSpace(spSketchImg.node.position);\r\n        if(refPosition != null && mousePosition != null){\r\n            var beginX = refPosition.x - 256;\r\n            var beginY = refPosition.y - 256;\r\n            relativeX = mousePosition.x - beginX;\r\n            relativeY = mousePosition.y - beginY;\r\n            var mouseInSketch = (relativeX > 0 && relativeY > 0 && relativeX < spSketchImg.node.width && relativeY < spSketchImg.node.height);\r\n            if(mouseInSketch){\r\n                painting = true;\r\n            }\r\n        }\r\n        if(painting){\r\n            if(mouseIsDown){\r\n                var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n                \r\n                if(isPen){\r\n                    var pen = 6 - version;\r\n                    cxt.beginPath();\r\n                    cxt.arc(parseInt(parseFloat(relativeX) / parseFloat(spHintNode.width) * parseFloat(HTML_Canvas_hint.width)), parseInt(parseFloat(spHintNode.height - relativeY) / parseFloat(spHintNode.height) * parseFloat(HTML_Canvas_hint.height)), pen, 0, Math.PI * 2, true);\r\n                    cxt.closePath();\r\n                    var color = spColorImg.node.color\r\n                    cxt.fillStyle = 'rgba('+color.r.toString()+','+color.g.toString()+','+color.b.toString()+',0.618)';\r\n                    cxt.fill();\r\n                }else{\r\n                    var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n                    cxt.clearRect(parseInt(parseFloat(relativeX) / parseFloat(spHintNode.width) * parseFloat(HTML_Canvas_hint.width)) - 10, parseInt(parseFloat(spHintNode.height - relativeY) / parseFloat(spHintNode.height) * parseFloat(HTML_Canvas_hint.height)) - 10,20,20);\r\n                }\r\n                \r\n                var hintNodeTex = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n                hintNodeTex.initWithElement(HTML_Canvas_hint);\r\n                hintNodeTex.handleLoadedTexture(true);\r\n            }\r\n        }\r\n    },\r\n    handleColorPicker: function(){\r\n        var refPosition = spRefereneImg.node.convertToWorldSpace(spRefereneImg.node.position);\r\n            if(refPosition != null && mousePosition != null){\r\n                var beginX = refPosition.x;\r\n                var beginY = refPosition.y;\r\n                var relativeX = mousePosition.x - beginX;\r\n                var relativeY = mousePosition.y - beginY;\r\n                mouseInReference = (relativeX > 0 && relativeY > 0 && relativeX < spRefereneImg.node.width && relativeY < spRefereneImg.node.height);\r\n                if(mouseInReference){\r\n                    if(!preMouseInRef){\r\n                        selectingColor = true;\r\n                    }\r\n                    if(getMouseDown){\r\n                        if(selectingColor){\r\n                        this.flag.x = relativeX - spRefereneImg.node.width / 2;\r\n                        this.flag.y = relativeY - spRefereneImg.node.height / 2;\r\n                        finalX = relativeX;\r\n                        finalY = relativeY;\r\n                        isPen = true;\r\n                        }\r\n                    }\r\n                }else{\r\n                    if(selectingColor){\r\n                        selectingColor = false;\r\n                        var texture = spRefereneImg.spriteFrame.getTexture();\r\n                        spColorImg.node.color = spRefereneImg.spriteFrame.getTexture().getPixels(finalX,finalY,spRefereneImg.node.width,spRefereneImg.node.height);\r\n                    }\r\n                }\r\n                if(selectingColor){\r\n                    var texture = spRefereneImg.spriteFrame.getTexture();\r\n                    spColorImg.node.color = spRefereneImg.spriteFrame.getTexture().getPixels(relativeX,relativeY,spRefereneImg.node.width,spRefereneImg.node.height);\r\n                }\r\n            }\r\n    },\r\n    update: function (dt) {\r\n        if(loaded){\r\n            this.handleColorPicker();\r\n            this.handlePainter();\r\n            if(selectingColor)\r\n            {\r\n                document.body.style.cursor='crosshair';\r\n            }\r\n            else if(painting)\r\n            {\r\n                document.body.style.cursor='crosshair';\r\n            }\r\n            else\r\n            {\r\n                document.body.style.cursor='default';\r\n            }\r\n        }\r\n        preMouseInRef = mouseInReference;\r\n        getMouseDown = false;\r\n    },\r\n});\r\n"]}