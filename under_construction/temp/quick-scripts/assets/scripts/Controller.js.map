{"version":3,"sources":["Controller.js"],"names":["spSketchImg","spRefereneImg","spResultImg","spColorImg","spHintNode","spBTN","spLAB","fileInputForSketch","fileInputForReferene","mousePosition","mouseInReference","loaded","getMouseDown","preMouseInRef","selectingColor","painting","finalX","finalY","hasSketch","hasRef","HTML_Canvas_sketch","HTML_Canvas_reference","HTML_Canvas_hint","isPen","mouseIsDown","sketchID","referenceID","tempID","resultURL","version","denoiseV","view_node","temp_btn_str","sketch_w","sketch_h","white_result","spQuickBTN","spWaiting","createObjectURL","blob","window","URL","undefined","onSketchFileSelected","evt","loadLocalSketch","target","files","onRefereneFileSelected","loadLocalReference","uri","tempDiv","document","getElementById","createElement","body","appendChild","style","position","id","innerHTML","display","visibility","img","onload","w_224","parseFloat","width","h_224","height","w_380","h_380","node","parseInt","getContext","drawImage","clearRect","referenceNodeTexture","spriteFrame","getTexture","hintNodeTexture","getComponent","initWithElement","handleLoadedTexture","tempCanvas_200","_pixels","getImageData","data","src","resultTexture","loadLocalResult","split","length","Math","random","toString","cc","textureCache","addImage","w","h","sketchNodeTexture","setTexture","opacity","Texture2D","prototype","getPixels","x","y","newWidth","newHeight","idx","color","Class","extends","Component","properties","sketchImg","default","type","Node","referenceImg","resultImg","colorImg","flag","hint","btn","view","quickBTN","waiting","loading","String","onV1","onClearClicked","onV2","onV3","onV4","onD0","onD1","onD2","onLoad","director","setClearColor","accept","overflow","insertBefore","firstChild","addEventListener","on","event","getLocation","onSketchClicked","click","onRefenceClicked","onPenClicked","onEraserClicked","cxt","hintNodeTex","onColorizeClicked","hintDataURL","toDataURL","referenceDataURL","sketchDataURL","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","responseText","send","encodeURIComponent","enabled","string","onDownloadClicked","handlePainter","relativeX","relativeY","refPosition","convertToWorldSpace","mouseInSketch","pen","beginPath","arc","PI","closePath","fillStyle","r","g","b","fill","handleColorPicker","beginX","beginY","texture","update","dt","cursor","max_w","max_h","s0","s1","s","min","isLoaded"],"mappings":";;;;;;AAAA,IAAIA,WAAJ;AACA,IAAIC,aAAJ;AACA,IAAIC,WAAJ;AACA,IAAIC,UAAJ;AACA,IAAIC,UAAJ;AACA,IAAIC,KAAJ;AACA,IAAIC,KAAJ;;AAEA,IAAIC,kBAAJ;AACA,IAAIC,oBAAJ;;AAEA,IAAIC,aAAJ;AACA,IAAIC,mBAAmB,KAAvB;;AAEA,IAAIC,SAAS,KAAb;;AAEA,IAAIC,eAAe,KAAnB;AACA,IAAIC,gBAAgB,KAApB;AACA,IAAIC,iBAAiB,KAArB;AACA,IAAIC,WAAW,KAAf;AACA,IAAIC,SAAO,CAAX;AACA,IAAIC,SAAO,CAAX;;AAEA,IAAIC,YAAU,KAAd;AACA,IAAIC,SAAO,KAAX;;AAEA,IAAIC,kBAAJ;AACA,IAAIC,qBAAJ;AACA,IAAIC,gBAAJ;;AAEA,IAAIC,QAAQ,IAAZ;;AAEA,IAAIC,cAAc,KAAlB;;AAEA,IAAIC,WAAW,KAAf;AACA,IAAIC,cAAc,KAAlB;AACA,IAAIC,MAAJ;;AAEA,IAAIC,YAAY,EAAhB;;AAEA,IAAIC,UAAU,CAAd;;AAEA,IAAIC,WAAW,CAAf;;AAEA,IAAIC,SAAJ;;AAEA,IAAIC,YAAJ;;AAEA,IAAIC,WAAW,EAAf;AACA,IAAIC,WAAW,EAAf;;AAEA,IAAIC,YAAJ;;AAEA,IAAIC,UAAJ;AACA,IAAIC,SAAJ;;AAEA,SAASC,eAAT,CAAyBC,IAAzB,EAA8B;AAC1B,QAAGC,OAAOC,GAAP,KAAeC,SAAlB,EACI,OAAOF,OAAO,KAAP,EAAc,iBAAd,EAAiCD,IAAjC,CAAP,CADJ,KAGI,OAAOC,OAAO,WAAP,EAAoB,iBAApB,EAAuCD,IAAvC,CAAP;AACP;;AAED,SAASI,oBAAT,CAA8BC,GAA9B,EAAmC;AAC/BC,oBAAgBP,gBAAgBM,IAAIE,MAAJ,CAAWC,KAAX,CAAiB,CAAjB,CAAhB,CAAhB;AACH;;AAED,SAASC,sBAAT,CAAgCJ,GAAhC,EAAqC;AACjCK,uBAAmBX,gBAAgBM,IAAIE,MAAJ,CAAWC,KAAX,CAAiB,CAAjB,CAAhB,CAAnB;AACH;;AAED,SAASE,kBAAT,CAA4BC,GAA5B,EAAgC;AAC5B,QAAIC,UAAUC,SAASC,cAAT,CAAwB,kBAAxB,CAAd;AACH,QAAGF,YAAU,IAAb,EAAkB;AACd,YAAIA,UAAUC,SAASE,aAAT,CAAuB,KAAvB,CAAd;AACGF,iBAASG,IAAT,CAAcC,WAAd,CAA0BL,OAA1B;AACAA,gBAAQM,KAAR,CAAcC,QAAd,GAAuB,UAAvB;AACAP,gBAAQQ,EAAR,GAAW,kBAAX;AACAR,gBAAQS,SAAR,GAAoB,2BAApB;AACAT,gBAAQM,KAAR,CAAcI,OAAd,GAAsB,MAAtB;AACAV,gBAAQM,KAAR,CAAcK,UAAd,GAA2B,QAA3B;AACN;AACD,QAAIC,MAAMX,SAASC,cAAT,CAAwB,kBAAxB,CAAV;AACGU,QAAIC,MAAJ,GAAa,YAAU;;AAEnB,YAAIC,QAAQC,WAAW,KAAKC,KAAhB,CAAZ;AACN,YAAIC,QAAQF,WAAW,KAAKG,MAAhB,CAAZ;AACA,YAAGJ,QAAQG,KAAX,EACA;AACIH,oBAAQ,QAAQG,KAAR,GAAgBH,KAAxB;AACAG,oBAAQ,KAAR;AACH,SAJD,MAMA;AACIA,oBAAQ,QAAQH,KAAR,GAAgBG,KAAxB;AACAH,oBAAQ,KAAR;AACH;;AAED,YAAIK,QAAQJ,WAAW,KAAKC,KAAhB,CAAZ;AACA,YAAII,QAAQL,WAAW,KAAKG,MAAhB,CAAZ;AACA,YAAGC,QAAQC,KAAX,EACA;AACID,oBAAQ,QAAQC,KAAR,GAAgBD,KAAxB;AACMC,oBAAQ,KAAR;AACT,SAJD,MAMA;AACUA,oBAAQ,QAAQD,KAAR,GAAgBC,KAAxB;AACAD,oBAAQ,KAAR;AACT;;AAEDrE,sBAAcuE,IAAd,CAAmBL,KAAnB,GAA2BM,SAASH,KAAT,CAA3B;AACArE,sBAAcuE,IAAd,CAAmBH,MAAnB,GAA4BI,SAASF,KAAT,CAA5B;AACAlD,8BAAsB8C,KAAtB,GAA8BM,SAASR,KAAT,CAA9B;AACM5C,8BAAsBgD,MAAtB,GAA+BI,SAASL,KAAT,CAA/B;;AAEA/C,8BAAsBqD,UAAtB,CAAiC,IAAjC,EAAuCC,SAAvC,CAAiD,IAAjD,EAAuD,CAAvD,EAA0D,CAA1D,EAA6DtD,sBAAsB8C,KAAnF,EAA0F9C,sBAAsBgD,MAAhH;AACA/C,yBAAiBoD,UAAjB,CAA4B,IAA5B,EAAkCE,SAAlC,CAA4C,CAA5C,EAA8C,CAA9C,EAAgDtD,iBAAiB6C,KAAjE,EAAuE7C,iBAAiB+C,MAAxF;;AAEA,YAAIQ,uBAAuB5E,cAAc6E,WAAd,CAA0BC,UAA1B,EAA3B;AACN,YAAIC,kBAAkB5E,WAAW6E,YAAX,CAAwB,WAAxB,EAAqCH,WAArC,CAAiDC,UAAjD,EAAtB;;AAEAC,wBAAgBE,eAAhB,CAAgC5D,gBAAhC;AACA0D,wBAAgBG,mBAAhB;;AAEAN,6BAAqBK,eAArB,CAAqC7D,qBAArC;AACAwD,6BAAqBM,mBAArB;;AAEA,YAAIC,iBAAiBhC,SAASE,aAAT,CAAuB,QAAvB,CAArB;AACM8B,uBAAejB,KAAf,GAAuBM,SAASH,KAAT,CAAvB;AACAc,uBAAef,MAAf,GAAwBI,SAASF,KAAT,CAAxB;AACAa,uBAAeV,UAAf,CAA0B,IAA1B,EAAgCC,SAAhC,CAA0C,IAA1C,EAAgD,CAAhD,EAAmD,CAAnD,EAAsDS,eAAejB,KAArE,EAA4EiB,eAAef,MAA3F;AACAQ,6BAAqBQ,OAArB,GAA+BD,eAAeV,UAAf,CAA0B,IAA1B,EAAgCY,YAAhC,CAA6C,CAA7C,EAAgD,CAAhD,EAAmDF,eAAejB,KAAlE,EAAyEiB,eAAef,MAAxF,EAAgGkB,IAA/H;;AAENpE,iBAAS,IAAT;AACAO,sBAAc,KAAd;AACG,KArDD;AAsDHqC,QAAIyB,GAAJ,GAAUtC,GAAV;AACA;;AAED,IAAIuC,gBAAgB,IAApB;;AAEA,SAASC,eAAT,CAAyBxC,GAAzB,EAA6B;AACzBvB,aAASuB,IAAIyC,KAAJ,CAAU,GAAV,CAAT;AACA,QAAIhE,OAAOiE,MAAP,IAAiB,CAArB,EAAwB;AACpBhE,oBAAY,aAAaD,OAAO,CAAP,CAAb,GAAyB,SAAzB,GAAqCkE,KAAKC,MAAL,GAAcC,QAAd,EAAjD;AACAN,wBAAgBO,GAAGC,YAAH,CAAgBC,QAAhB,CAAyBtE,SAAzB,CAAhB;AACH;AACJ;;AAED,SAASiB,eAAT,CAAyBK,GAAzB,EAA6B;AACzB,QAAIC,UAAUC,SAASC,cAAT,CAAwB,eAAxB,CAAd;AACH,QAAGF,YAAU,IAAb,EAAkB;AACd,YAAIA,UAAUC,SAASE,aAAT,CAAuB,KAAvB,CAAd;AACGF,iBAASG,IAAT,CAAcC,WAAd,CAA0BL,OAA1B;AACAA,gBAAQM,KAAR,CAAcC,QAAd,GAAuB,UAAvB;AACAP,gBAAQQ,EAAR,GAAW,eAAX;AACAR,gBAAQS,SAAR,GAAoB,wBAApB;AACAT,gBAAQM,KAAR,CAAcI,OAAd,GAAsB,MAAtB;AACAV,gBAAQM,KAAR,CAAcK,UAAd,GAA2B,QAA3B;AACN;AACD,QAAIC,MAAMX,SAASC,cAAT,CAAwB,eAAxB,CAAV;AACGU,QAAIC,MAAJ,GAAa,YAAU;;AAEnB,YAAImC,IAAIjC,WAAW,KAAKC,KAAhB,CAAR;AACN,YAAIiC,IAAIlC,WAAW,KAAKG,MAAhB,CAAR;;AAEA,YAAG+B,IAAED,CAAL,EAAO;AACH,gBAAGC,IAAE,IAAL,EAAU;AACND,oBAAI,SAASC,CAAT,GAAaD,CAAjB;AACAC,oBAAI,MAAJ;AACH;AACJ,SALD,MAKK;AACD,gBAAGD,IAAE,IAAL,EAAU;AACNC,oBAAI,SAASD,CAAT,GAAaC,CAAjB;AACAD,oBAAI,MAAJ;AACH;AACJ;;AAED/E,2BAAmB+C,KAAnB,GAA2BM,SAAS0B,CAAT,CAA3B;AACM/E,2BAAmBiD,MAAnB,GAA4BI,SAAS2B,CAAT,CAA5B;;AAEN,YAAGD,IAAIC,CAAP,EACA;AACID,gBAAI,QAAQC,CAAR,GAAYD,CAAhB;AACAC,gBAAI,KAAJ;AACH,SAJD,MAMA;AACIA,gBAAI,QAAQD,CAAR,GAAYC,CAAhB;AACAD,gBAAI,KAAJ;AACH;;AAEK7E,yBAAiB6C,KAAjB,GAAyBM,SAAS0B,CAAT,CAAzB;AACN7E,yBAAiB+C,MAAjB,GAA0BI,SAAS2B,CAAT,CAA1B;;AAEMnE,mBAAWiC,WAAW,KAAKC,KAAhB,CAAX;AACAjC,mBAAWgC,WAAW,KAAKG,MAAhB,CAAX;;AAEAjD,2BAAmBsD,UAAnB,CAA8B,IAA9B,EAAoCC,SAApC,CAA8C,IAA9C,EAAoD,CAApD,EAAuD,CAAvD,EAA0DvD,mBAAmB+C,KAA7E,EAAoF/C,mBAAmBiD,MAAvG;AACH/C,yBAAiBoD,UAAjB,CAA4B,IAA5B,EAAkCE,SAAlC,CAA4C,CAA5C,EAA8C,CAA9C,EAAgDtD,iBAAiB6C,KAAjE,EAAuE7C,iBAAiB+C,MAAxF;;AAEG,YAAIW,kBAAkB5E,WAAW6E,YAAX,CAAwB,WAAxB,EAAqCH,WAArC,CAAiDC,UAAjD,EAAtB;AACNC,wBAAgBE,eAAhB,CAAgC5D,gBAAhC;AACA0D,wBAAgBG,mBAAhB;;AAEA,YAAIkB,oBAAoBrG,YAAY8E,WAAZ,CAAwBC,UAAxB,EAAxB;AACAsB,0BAAkBnB,eAAlB,CAAkC9D,kBAAlC;AACAiF,0BAAkBlB,mBAAlB;;AAEAjE,oBAAY,IAAZ;AACAO,mBAAW,KAAX;AACMC,sBAAc,KAAd;AACAxB,oBAAY4E,WAAZ,CAAwBwB,UAAxB,CAAmCnE,YAAnC;;AAEAC,mBAAWmE,OAAX,GAAqB,GAArB;AACH,KAtDD;AAuDHxC,QAAIyB,GAAJ,GAAUtC,GAAV;AACA;;AAED8C,GAAGQ,SAAH,CAAaC,SAAb,CAAuBpB,OAAvB,GAAiC,EAAjC;AACAW,GAAGQ,SAAH,CAAaC,SAAb,CAAuBC,SAAvB,GAAmC,UAASC,CAAT,EAAWC,CAAX,EAAaC,QAAb,EAAsBC,SAAtB,EAAgC;AAC/D,QAAIC,MAAMtC,SAAS,CAACqC,YAAUrC,SAASmC,CAAT,CAAX,IAA0BC,QAA1B,GAAqC,CAArC,GAAyCpC,SAASkC,CAAT,IAAc,CAAhE,CAAV;AACA,WAAO,IAAIX,GAAGgB,KAAP,CAAa,KAAK3B,OAAL,CAAa0B,GAAb,CAAb,EAA+B,KAAK1B,OAAL,CAAa0B,MAAM,CAAnB,CAA/B,EAAqD,KAAK1B,OAAL,CAAa0B,MAAM,CAAnB,CAArD,CAAP;AACH,CAHD;;AAKAf,GAAGiB,KAAH,CAAS;AACLC,aAASlB,GAAGmB,SADP;;AAGLC,gBAAY;AACRC,mBAAU;AACNC,qBAAQ,IADF,EACOC,MAAKvB,GAAGwB;AADf,SADF;AAIRC,sBAAa;AACTH,qBAAQ,IADC,EACIC,MAAKvB,GAAGwB;AADZ,SAJL;AAORE,mBAAU;AACNJ,qBAAQ,IADF,EACOC,MAAKvB,GAAGwB;AADf,SAPF;AAURG,kBAAS;AACLL,qBAAQ,IADH,EACQC,MAAKvB,GAAGwB;AADhB,SAVD;AAaRI,cAAK;AACDN,qBAAQ,IADP,EACYC,MAAKvB,GAAGwB;AADpB,SAbG;AAgBRK,cAAK;AACDP,qBAAQ,IADP,EACYC,MAAKvB,GAAGwB;AADpB,SAhBG;AAmBRM,aAAI;AACAR,qBAAQ,IADR,EACaC,MAAKvB,GAAGwB;AADrB,SAnBI;AAsBRO,cAAM;AACFT,qBAAS,IADP,EACaC,MAAMvB,GAAGwB;AADtB,SAtBE;AAyBRQ,kBAAU;AACNV,qBAAS,IADH,EACSC,MAAMvB,GAAGwB;AADlB,SAzBF;AA4BRS,iBAAS;AACLX,qBAAS,IADJ,EACUC,MAAMvB,GAAGwB;AADnB,SA5BD;AA+BRU,iBAAS;AACLZ,qBAAS,EADJ,EACQC,MAAMvB,GAAGmC;AADjB;AA/BD,KAHP;;AAuCLC,UAAM,gBAAU;AACZvG,kBAAU,CAAV;AACA,aAAKwG,cAAL;AACH,KA1CI;;AA4CLC,UAAM,gBAAU;AACZzG,kBAAU,CAAV;AACA,aAAKwG,cAAL;AACH,KA/CI;;AAiDLE,UAAM,gBAAU;AACZ1G,kBAAU,CAAV;AACA,aAAKwG,cAAL;AACH,KApDI;;AAsDLG,UAAM,gBAAU;AACZ3G,kBAAU,CAAV;AACA,aAAKwG,cAAL;AACH,KAzDI;;AA2DLI,UAAM,gBAAU;AACZ3G,mBAAW,CAAX;AACH,KA7DI;;AA+DL4G,UAAM,gBAAU;AACZ5G,mBAAW,CAAX;AACH,KAjEI;;AAmEL6G,UAAM,gBAAU;AACZ7G,mBAAW,CAAX;AACH,KArEI;;AAuEL8G,YAAQ,kBAAY;;AAEhB5C,WAAG6C,QAAH,CAAYC,aAAZ,CAA0B9C,GAAGgB,KAAH,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAA1B;;AAEAhH,sBAAc,KAAKqH,SAAL,CAAepC,YAAf,CAA4B,WAA5B,CAAd;AACAhF,wBAAgB,KAAKwH,YAAL,CAAkBxC,YAAlB,CAA+B,WAA/B,CAAhB;AACA/E,sBAAc,KAAKwH,SAAL,CAAezC,YAAf,CAA4B,WAA5B,CAAd;AACA9E,qBAAa,KAAKwH,QAAL,CAAc1C,YAAd,CAA2B,WAA3B,CAAb;AACA7E,qBAAa,KAAKyH,IAAlB;AACA9F,oBAAY,KAAKgG,IAAjB;AACA1H,gBAAQ,KAAKyH,GAAL,CAAS7C,YAAT,CAAsB,WAAtB,CAAR;AACA3E,gBAAQ,KAAKwH,GAAL,CAAS7C,YAAT,CAAsB,aAAtB,CAAR;;AAEA9C,uBAAejC,YAAY4E,WAAZ,CAAwBC,UAAxB,EAAf;;AAEAxE,6BAAqB6C,SAASE,aAAT,CAAuB,OAAvB,CAArB;AACA/C,2BAAmBoD,EAAnB,GAAwB,oBAAxB;AACApD,2BAAmBgH,IAAnB,GAA0B,MAA1B;AACAhH,2BAAmBwI,MAAnB,GAA4B,SAA5B;AACAxI,2BAAmBkD,KAAnB,CAAyBY,MAAzB,GAAkC,KAAlC;AACA9D,2BAAmBkD,KAAnB,CAAyBI,OAAzB,GAAmC,OAAnC;AACAtD,2BAAmBkD,KAAnB,CAAyBuF,QAAzB,GAAoC,QAApC;AACA5F,iBAASG,IAAT,CAAc0F,YAAd,CAA2B1I,kBAA3B,EAA8C6C,SAASG,IAAT,CAAc2F,UAA5D;AACA3I,2BAAmB4I,gBAAnB,CAAoC,QAApC,EAA8CxG,oBAA9C,EAAoE,KAApE;;AAEAnC,+BAAuB4C,SAASE,aAAT,CAAuB,OAAvB,CAAvB;AACA9C,6BAAqBmD,EAArB,GAA0B,sBAA1B;AACAnD,6BAAqB+G,IAArB,GAA4B,MAA5B;AACA/G,6BAAqBuI,MAArB,GAA8B,SAA9B;AACAvI,6BAAqBiD,KAArB,CAA2BY,MAA3B,GAAoC,KAApC;AACA7D,6BAAqBiD,KAArB,CAA2BI,OAA3B,GAAqC,OAArC;AACArD,6BAAqBiD,KAArB,CAA2BuF,QAA3B,GAAsC,QAAtC;AACA5F,iBAASG,IAAT,CAAc0F,YAAd,CAA2BzI,oBAA3B,EAAgD4C,SAASG,IAAT,CAAc2F,UAA9D;AACA1I,6BAAqB2I,gBAArB,CAAsC,QAAtC,EAAgDnG,sBAAhD,EAAwE,KAAxE;;AAEA,aAAKwB,IAAL,CAAU4E,EAAV,CAAa,WAAb,EAA0B,UAAUC,KAAV,EAAiB;AACvC5I,4BAAgB4I,MAAMC,WAAN,EAAhB;AACH,SAFD;;AAIA,aAAK9E,IAAL,CAAU4E,EAAV,CAAa,WAAb,EAA0B,UAAUC,KAAV,EAAiB;AACvC7H,0BAAc,IAAd;AACH,SAFD;;AAIA,aAAKgD,IAAL,CAAU4E,EAAV,CAAa,SAAb,EAAwB,UAAUC,KAAV,EAAiB;AACrCzI,2BAAe,IAAf;AACAY,0BAAc,KAAd;AACH,SAHD;;AAKAF,2BAAmB8B,SAASE,aAAT,CAAuB,QAAvB,CAAnB;AACAhC,yBAAiBqC,EAAjB,GAAsB,kBAAtB;;AAEAtC,gCAAwB+B,SAASE,aAAT,CAAuB,QAAvB,CAAxB;AACAjC,8BAAsBsC,EAAtB,GAA2B,uBAA3B;;AAEAvC,6BAAqBgC,SAASE,aAAT,CAAuB,QAAvB,CAArB;AACAlC,2BAAmBuC,EAAnB,GAAwB,oBAAxB;;AAEAvB,qBAAa,KAAK4F,QAAlB;AACA3F,oBAAY,KAAK4F,OAAjB;;AAEA,aAAKD,QAAL,CAAczB,OAAd,GAAwB,CAAxB;AACA,aAAK0B,OAAL,CAAa1B,OAAb,GAAuB,CAAvB;;AAEA5F,iBAAS,IAAT;AAEH,KAxII;;AA0IL4I,qBAAiB,2BAAU;AACvBhJ,2BAAmBiJ,KAAnB;AACH,KA5II;AA6ILC,sBAAkB,4BAAU;AACxBjJ,6BAAqBgJ,KAArB;AACH,KA/II;AAgJLE,kBAAc,wBAAU;AACpBnI,gBAAQ,IAAR;AACH,KAlJI;AAmJLoI,qBAAiB,2BAAU;AACvBpI,gBAAQ,KAAR;AACH,KArJI;AAsJL8G,oBAAgB,0BAAU;AACtB,YAAIuB,MAAItI,iBAAiBoD,UAAjB,CAA4B,IAA5B,CAAR;AACHkF,YAAIhF,SAAJ,CAAc,CAAd,EAAgB,CAAhB,EAAkBtD,iBAAiB6C,KAAnC,EAAyC7C,iBAAiB+C,MAA1D;AACG,YAAIwF,cAAczJ,WAAW6E,YAAX,CAAwB,WAAxB,EAAqCH,WAArC,CAAiDC,UAAjD,EAAlB;AACN8E,oBAAY3E,eAAZ,CAA4B5D,gBAA5B;AACAuI,oBAAY1E,mBAAZ;AACG,KA5JI;AA6JL2E,uBAAmB,6BAAU;AACzB,YAAG,CAAC3I,MAAJ,EAAW;AACP;AACH;AACD,YAAG,CAACD,SAAJ,EAAc;AACV;AACH;;AAED,aAAK+G,OAAL,CAAa1B,OAAb,GAAuB,GAAvB;AACA,aAAKyB,QAAL,CAAczB,OAAd,GAAwB,CAAxB;;AAEA,YAAIwD,cAAczI,iBAAiB0I,SAAjB,CAA2B,WAA3B,CAAlB;AACA,YAAIC,mBAAmB5I,sBAAsB2I,SAAtB,CAAgC,WAAhC,CAAvB;AACA,YAAIE,gBAAgB9I,mBAAmB4I,SAAnB,CAA6B,WAA7B,CAApB;;AAEA,YAAIG,MAAM,IAAIC,cAAJ,EAAV;AACAD,YAAIE,IAAJ,CAAS,MAAT,EAAiB,QAAjB,EAA2B,IAA3B;AACAF,YAAIG,gBAAJ,CAAqB,cAArB,EAAoC,oCAApC;AACAH,YAAII,kBAAJ,GAAyB,YAAW;AAChC7E,4BAAgByE,IAAIK,YAApB;AACH,SAFD;AAGA,YAAG/I,YAAU,KAAb,EAAmB;AACfyI,4BAAgB,MAAhB;AACH;AACD,YAAGxI,eAAa,KAAhB,EAAsB;AAClBuI,+BAAmB,MAAnB;AACH;AACDE,YAAIM,IAAJ,CAEI,YAAUC,mBAAmBR,aAAnB,CAAV,GACA,aADA,GACcQ,mBAAmBT,gBAAnB,CADd,GAEA,QAFA,GAESS,mBAAmBX,WAAnB,CAFT,GAGA,WAHA,GAGYlI,QAAQkE,QAAR,EAHZ,GAIA,WAJA,GAIYjE,SAASiE,QAAT,EAJZ,GAKA,YALA,GAKatE,QALb,GAMA,eANA,GAMgBC,WARpB;AAUArB,cAAMsK,OAAN,GAAgB,KAAhB;AACAlF,wBAAgB,IAAhB;AACAzD,uBAAe1B,MAAMsK,MAArB;AACAtK,cAAMsK,MAAN,GAAe,KAAK1C,OAApB;AACH,KAtMI;AAuML2C,uBAAmB,6BAAU;AACzB,YAAGjJ,aAAW,EAAd,EAAiB;AACb;AACH;AACDY,eAAO6H,IAAP,CAAYzI,SAAZ;AACH,KA5MI;AA6MLkJ,mBAAe,yBAAU;AACrB/J,mBAAW,KAAX;AACA,YAAIgK,YAAY,CAAhB;AACA,YAAIC,YAAY,CAAhB;AACA,YAAIC,cAAcjL,YAAYwE,IAAZ,CAAiB0G,mBAAjB,CAAqClL,YAAYwE,IAAZ,CAAiBd,QAAtD,CAAlB;AACA,YAAIuH,eAAe,IAAf,IAAuBxK,iBAAiB,IAA5C,EAAkD;AAC9CsK,wBAAYtK,cAAckG,CAAd,GAAkBsE,YAAYtE,CAA1C;AACAqE,wBAAYvK,cAAcmG,CAAd,GAAkBqE,YAAYrE,CAA1C;AACA,gBAAIuE,gBAAiBJ,YAAY,CAAZ,IAAiBC,YAAY,CAA7B,IAAkCD,YAAY/K,YAAYwE,IAAZ,CAAiBL,KAA/D,IAAwE6G,YAAYhL,YAAYwE,IAAZ,CAAiBH,MAA1H;AACA,gBAAG8G,aAAH,EAAiB;AACbpK,2BAAW,IAAX;AACH;AACJ;AACD,YAAGA,QAAH,EAAY;AACR,gBAAGS,WAAH,EAAe;AACX,oBAAIoI,MAAItI,iBAAiBoD,UAAjB,CAA4B,IAA5B,CAAR;;AAEA,oBAAGnD,KAAH,EAAS;AACL,wBAAI6J,MAAM,IAAIvJ,OAAd;AACA+H,wBAAIyB,SAAJ;AACAzB,wBAAI0B,GAAJ,CAAQ7G,SAASP,WAAW6G,SAAX,IAAwB7G,WAAW9D,WAAW+D,KAAtB,CAAxB,GAAuDD,WAAW5C,iBAAiB6C,KAA5B,CAAhE,CAAR,EAA6GM,SAASP,WAAW9D,WAAWiE,MAAX,GAAoB2G,SAA/B,IAA4C9G,WAAW9D,WAAWiE,MAAtB,CAA5C,GAA4EH,WAAW5C,iBAAiB+C,MAA5B,CAArF,CAA7G,EAAwO+G,GAAxO,EAA6O,CAA7O,EAAgPvF,KAAK0F,EAAL,GAAU,CAA1P,EAA6P,IAA7P;AACA3B,wBAAI4B,SAAJ;AACA,wBAAIxE,QAAQ7G,WAAWqE,IAAX,CAAgBwC,KAA5B;AACA4C,wBAAI6B,SAAJ,GAAgB,UAAQzE,MAAM0E,CAAN,CAAQ3F,QAAR,EAAR,GAA2B,GAA3B,GAA+BiB,MAAM2E,CAAN,CAAQ5F,QAAR,EAA/B,GAAkD,GAAlD,GAAsDiB,MAAM4E,CAAN,CAAQ7F,QAAR,EAAtD,GAAyE,SAAzF;AACA6D,wBAAIiC,IAAJ;AACH,iBARD,MAQK;AACD,wBAAIjC,MAAItI,iBAAiBoD,UAAjB,CAA4B,IAA5B,CAAR;AACAkF,wBAAIhF,SAAJ,CAAcH,SAASP,WAAW6G,SAAX,IAAwB7G,WAAW9D,WAAW+D,KAAtB,CAAxB,GAAuDD,WAAW5C,iBAAiB6C,KAA5B,CAAhE,IAAsG,EAApH,EAAwHM,SAASP,WAAW9D,WAAWiE,MAAX,GAAoB2G,SAA/B,IAA4C9G,WAAW9D,WAAWiE,MAAtB,CAA5C,GAA4EH,WAAW5C,iBAAiB+C,MAA5B,CAArF,IAA4H,EAApP,EAAuP,EAAvP,EAA0P,EAA1P;AACH;;AAED,oBAAIwF,cAAczJ,WAAW6E,YAAX,CAAwB,WAAxB,EAAqCH,WAArC,CAAiDC,UAAjD,EAAlB;AACA8E,4BAAY3E,eAAZ,CAA4B5D,gBAA5B;AACAuI,4BAAY1E,mBAAZ,CAAgC,IAAhC;AACH;AACJ;AACJ,KAhPI;AAiPL2G,uBAAmB,6BAAU;AACzB,YAAIb,cAAchL,cAAcuE,IAAd,CAAmB0G,mBAAnB,CAAuCjL,cAAcuE,IAAd,CAAmBd,QAA1D,CAAlB;AACI,YAAGuH,eAAe,IAAf,IAAuBxK,iBAAiB,IAA3C,EAAgD;AAC5C,gBAAIsL,SAASd,YAAYtE,CAAzB;AACA,gBAAIqF,SAASf,YAAYrE,CAAzB;AACA,gBAAImE,YAAYtK,cAAckG,CAAd,GAAkBoF,MAAlC;AACA,gBAAIf,YAAYvK,cAAcmG,CAAd,GAAkBoF,MAAlC;AACAtL,+BAAoBqK,YAAY,CAAZ,IAAiBC,YAAY,CAA7B,IAAkCD,YAAY9K,cAAcuE,IAAd,CAAmBL,KAAjE,IAA0E6G,YAAY/K,cAAcuE,IAAd,CAAmBH,MAA7H;AACA,gBAAG3D,gBAAH,EAAoB;AAChB,oBAAG,CAACG,aAAJ,EAAkB;AACdC,qCAAiB,IAAjB;AACH;AACD,oBAAGF,YAAH,EAAgB;AACZ,wBAAGE,cAAH,EAAkB;AAClB,6BAAK8G,IAAL,CAAUjB,CAAV,GAAcoE,YAAY9K,cAAcuE,IAAd,CAAmBL,KAAnB,GAA2B,CAArD;AACA,6BAAKyD,IAAL,CAAUhB,CAAV,GAAcoE,YAAY/K,cAAcuE,IAAd,CAAmBH,MAAnB,GAA4B,CAAtD;AACArD,iCAAS+J,SAAT;AACA9J,iCAAS+J,SAAT;AACAzJ,gCAAQ,IAAR;AACC;AACJ;AACJ,aAbD,MAaK;AACD,oBAAGT,cAAH,EAAkB;AACdA,qCAAiB,KAAjB;AACA,wBAAImL,UAAUhM,cAAc6E,WAAd,CAA0BC,UAA1B,EAAd;AACA5E,+BAAWqE,IAAX,CAAgBwC,KAAhB,GAAwB/G,cAAc6E,WAAd,CAA0BC,UAA1B,GAAuC2B,SAAvC,CAAiD1F,MAAjD,EAAwDC,MAAxD,EAA+DhB,cAAcuE,IAAd,CAAmBL,KAAlF,EAAwFlE,cAAcuE,IAAd,CAAmBH,MAA3G,CAAxB;AACH;AACJ;AACD,gBAAGvD,cAAH,EAAkB;AACd,oBAAImL,UAAUhM,cAAc6E,WAAd,CAA0BC,UAA1B,EAAd;AACA5E,2BAAWqE,IAAX,CAAgBwC,KAAhB,GAAwB/G,cAAc6E,WAAd,CAA0BC,UAA1B,GAAuC2B,SAAvC,CAAiDqE,SAAjD,EAA2DC,SAA3D,EAAqE/K,cAAcuE,IAAd,CAAmBL,KAAxF,EAA8FlE,cAAcuE,IAAd,CAAmBH,MAAjH,CAAxB;AACH;AACJ;AACR,KAlRI;AAmRL6H,YAAQ,gBAAUC,EAAV,EAAc;AAClB,YAAGxL,MAAH,EAAU;AACN,iBAAKmL,iBAAL;AACA,iBAAKhB,aAAL;AACA,gBAAGhK,cAAH,EACA;AACIsC,yBAASG,IAAT,CAAcE,KAAd,CAAoB2I,MAApB,GAA2B,WAA3B;AACH,aAHD,MAIK,IAAGrL,QAAH,EACL;AACIqC,yBAASG,IAAT,CAAcE,KAAd,CAAoB2I,MAApB,GAA2B,WAA3B;AACH,aAHI,MAKL;AACIhJ,yBAASG,IAAT,CAAcE,KAAd,CAAoB2I,MAApB,GAA2B,SAA3B;AACH;AACJ;AACDvL,wBAAgBH,gBAAhB;AACAE,uBAAe,KAAf;;AAEA,YAAIuF,IAAIjC,WAAWjC,QAAX,CAAR;AACA,YAAImE,IAAIlC,WAAWhC,QAAX,CAAR;AACA,YAAImK,QAAQnI,WAAWnC,UAAUoC,KAAV,GAAkB,EAA7B,CAAZ;AACA,YAAImI,QAAQpI,WAAWnC,UAAUsC,MAArB,CAAZ;AACA,YAAIkI,KAAKF,QAAQlG,CAAjB;AACA,YAAIqG,KAAKF,QAAQlG,CAAjB;AACA,YAAIqG,IAAI5G,KAAK6G,GAAL,CAASH,EAAT,EAAaC,EAAb,CAAR;AACArG,YAAIA,IAAIsG,CAAR;AACArG,YAAIA,IAAIqG,CAAR;AACAzM,oBAAYwE,IAAZ,CAAiBL,KAAjB,GAAyBM,SAAS0B,CAAT,CAAzB;AACAnG,oBAAYwE,IAAZ,CAAiBH,MAAjB,GAA0BI,SAAS2B,CAAT,CAA1B;AACAhG,mBAAW+D,KAAX,GAAmBM,SAAS0B,CAAT,CAAnB;AACA/F,mBAAWiE,MAAX,GAAoBI,SAAS2B,CAAT,CAApB;AACAlG,oBAAYsE,IAAZ,CAAiBL,KAAjB,GAAyBM,SAAS0B,CAAT,CAAzB;AACAjG,oBAAYsE,IAAZ,CAAiBH,MAAjB,GAA0BI,SAAS2B,CAAT,CAA1B;;AAEA,YAAI/F,MAAMsK,OAAN,IAAiB,KAArB,EAA4B;AACxB,gBAAIlF,iBAAiB,IAArB,EAA2B;AACvB,oBAAIA,cAAckH,QAAd,EAAJ,EAA8B;AAC1BzM,gCAAY4E,WAAZ,CAAwBwB,UAAxB,CAAmCb,aAAnC;AACApF,0BAAMsK,OAAN,GAAgB,IAAhB;AACArK,0BAAMsK,MAAN,GAAe5I,YAAf;AACAP,+BAAWE,OAAO,CAAP,CAAX;AACAD,kCAAcC,OAAO,CAAP,CAAd;AACA,yBAAKsG,OAAL,CAAa1B,OAAb,GAAuB,CAAvB;AACA,yBAAKyB,QAAL,CAAczB,OAAd,GAAwB,GAAxB;AACH;AACJ;AACJ;AACJ;AApUI,CAAT","file":"Controller.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var spSketchImg;\r\nvar spRefereneImg;\r\nvar spResultImg;\r\nvar spColorImg;\r\nvar spHintNode;\r\nvar spBTN;\r\nvar spLAB;\r\n\r\nvar fileInputForSketch;\r\nvar fileInputForReferene;\r\n\r\nvar mousePosition;\r\nvar mouseInReference = false;\r\n\r\nvar loaded = false;\r\n\r\nvar getMouseDown = false;\r\nvar preMouseInRef = false;\r\nvar selectingColor = false;\r\nvar painting = false;\r\nvar finalX=0;\r\nvar finalY=0;\r\n\r\nvar hasSketch=false;\r\nvar hasRef=false;\r\n\r\nvar HTML_Canvas_sketch;\r\nvar HTML_Canvas_reference;\r\nvar HTML_Canvas_hint;\r\n\r\nvar isPen = true;\r\n\r\nvar mouseIsDown = false;\r\n\r\nvar sketchID = \"new\";\r\nvar referenceID = \"new\";\r\nvar tempID;\r\n\r\nvar resultURL = \"\";\r\n\r\nvar version = 2;\r\n\r\nvar denoiseV = 0;\r\n\r\nvar view_node;\r\n\r\nvar temp_btn_str;\r\n\r\nvar sketch_w = 10;\r\nvar sketch_h = 10;\r\n\r\nvar white_result;\r\n\r\nvar spQuickBTN;\r\nvar spWaiting;\r\n\r\nfunction createObjectURL(blob){\r\n    if(window.URL !== undefined)\r\n        return window['URL']['createObjectURL'](blob);\r\n    else\r\n        return window['webkitURL']['createObjectURL'](blob);\r\n}\r\n\r\nfunction onSketchFileSelected(evt) {\r\n    loadLocalSketch(createObjectURL(evt.target.files[0]));\r\n}\r\n\r\nfunction onRefereneFileSelected(evt) {\r\n    loadLocalReference(createObjectURL(evt.target.files[0]));\r\n}\r\n\r\nfunction loadLocalReference(uri){\r\n    var tempDiv = document.getElementById(\"tempDivReference\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivReference\";\r\n        tempDiv.innerHTML = '<img id=imgheadReference>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadReference');\r\n    img.onload = function(){\r\n        \r\n        var w_224 = parseFloat(this.width);\r\n\t\tvar h_224 = parseFloat(this.height);\r\n\t\tif(w_224 > h_224)\r\n\t\t{\r\n\t\t    w_224 = 224.0 / h_224 * w_224;\r\n\t\t    h_224 = 224.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h_224 = 224.0 / w_224 * h_224;\r\n\t\t    w_224 = 224.0;\r\n\t\t}\r\n\t\t\r\n\t\tvar w_380 = parseFloat(this.width);\r\n\t\tvar h_380 = parseFloat(this.height);\r\n\t\tif(w_380 < h_380)\r\n\t\t{\r\n\t\t    w_380 = 380.0 / h_380 * w_380;\r\n            h_380 = 380.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n            h_380 = 380.0 / w_380 * h_380;\r\n            w_380 = 380.0;\r\n\t\t}\r\n\t\t\r\n\t\tspRefereneImg.node.width = parseInt(w_380);\r\n\t\tspRefereneImg.node.height = parseInt(h_380);\r\n\t\tHTML_Canvas_reference.width = parseInt(w_224);\r\n        HTML_Canvas_reference.height = parseInt(h_224);\r\n        \r\n        HTML_Canvas_reference.getContext(\"2d\").drawImage(this, 0, 0, HTML_Canvas_reference.width, HTML_Canvas_reference.height);\r\n        HTML_Canvas_hint.getContext(\"2d\").clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n        \r\n        var referenceNodeTexture = spRefereneImg.spriteFrame.getTexture();\r\n\t\tvar hintNodeTexture = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n        \r\n\t\thintNodeTexture.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\treferenceNodeTexture.initWithElement(HTML_Canvas_reference);\r\n\t\treferenceNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\tvar tempCanvas_200 = document.createElement(\"canvas\");\r\n        tempCanvas_200.width = parseInt(w_380);\r\n        tempCanvas_200.height = parseInt(h_380);\r\n        tempCanvas_200.getContext(\"2d\").drawImage(this, 0, 0, tempCanvas_200.width, tempCanvas_200.height);\r\n        referenceNodeTexture._pixels = tempCanvas_200.getContext(\"2d\").getImageData(0, 0, tempCanvas_200.width, tempCanvas_200.height).data;\r\n\t\t\r\n\t\thasRef = true;\r\n\t\treferenceID = \"new\";\r\n    }\r\n\timg.src = uri;\r\n}\r\n\r\nvar resultTexture = null;\r\n\r\nfunction loadLocalResult(uri){\r\n    tempID = uri.split(\"*\");\r\n    if (tempID.length == 2) {\r\n        resultURL = \"results/\" + tempID[0] + \".jpg?t=\" + Math.random().toString();\r\n        resultTexture = cc.textureCache.addImage(resultURL);\r\n    }\r\n}\r\n\r\nfunction loadLocalSketch(uri){\r\n    var tempDiv = document.getElementById(\"tempDivSketch\");\r\n\tif(tempDiv===null){\r\n\t    var tempDiv = document.createElement(\"div\");\r\n        document.body.appendChild(tempDiv);\r\n        tempDiv.style.position=\"absolute\";\r\n        tempDiv.id=\"tempDivSketch\";\r\n        tempDiv.innerHTML = '<img id=imgheadSketch>';\r\n        tempDiv.style.display='none';\r\n        tempDiv.style.visibility = \"hidden\";\r\n\t}\r\n\tvar img = document.getElementById('imgheadSketch');\r\n    img.onload = function(){\r\n        \r\n        var w = parseFloat(this.width);\r\n\t\tvar h = parseFloat(this.height);\r\n\t\t\r\n\t\tif(h<w){\r\n\t\t    if(h>1024){\r\n\t\t        w = 1024.0 / h * w;\r\n\t\t        h = 1024.0;\r\n\t\t    }\r\n\t\t}else{\r\n\t\t    if(w>1024){\r\n\t\t        h = 1024.0 / w * h;\r\n\t\t        w = 1024.0;\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tHTML_Canvas_sketch.width = parseInt(w);\r\n        HTML_Canvas_sketch.height = parseInt(h);\r\n        \r\n\t\tif(w > h)\r\n\t\t{\r\n\t\t    w = 512.0 / h * w;\r\n\t\t    h = 512.0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t    h = 512.0 / w * h;\r\n\t\t    w = 512.0;\r\n\t\t}\r\n        \r\n        HTML_Canvas_hint.width = parseInt(w);\r\n\t\tHTML_Canvas_hint.height = parseInt(h);\r\n\r\n        sketch_w = parseFloat(this.width);\r\n        sketch_h = parseFloat(this.height);\r\n\r\n        HTML_Canvas_sketch.getContext(\"2d\").drawImage(this, 0, 0, HTML_Canvas_sketch.width, HTML_Canvas_sketch.height);\r\n\t    HTML_Canvas_hint.getContext(\"2d\").clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n\t    \r\n        var hintNodeTexture = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n\t\thintNodeTexture.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\tvar sketchNodeTexture = spSketchImg.spriteFrame.getTexture();\r\n\t\tsketchNodeTexture.initWithElement(HTML_Canvas_sketch);\r\n\t\tsketchNodeTexture.handleLoadedTexture();\r\n\t\t\r\n\t\thasSketch = true;\r\n\t\tsketchID = \"new\";\r\n        referenceID = \"new\";\r\n        spResultImg.spriteFrame.setTexture(white_result);\r\n\r\n        spQuickBTN.opacity = 255;\r\n    }\r\n\timg.src = uri;\r\n}\r\n\r\ncc.Texture2D.prototype._pixels = [];\r\ncc.Texture2D.prototype.getPixels = function(x,y,newWidth,newHeight){\r\n    var idx = parseInt((newHeight-parseInt(y)) * newWidth * 4 + parseInt(x) * 4);\r\n    return new cc.color(this._pixels[idx],this._pixels[idx + 1],this._pixels[idx + 2]);\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        sketchImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        referenceImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        resultImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        colorImg:{\r\n            default:null,type:cc.Node\r\n        },\r\n        flag:{\r\n            default:null,type:cc.Node\r\n        },\r\n        hint:{\r\n            default:null,type:cc.Node\r\n        },\r\n        btn:{\r\n            default:null,type:cc.Node\r\n        },\r\n        view: {\r\n            default: null, type: cc.Node\r\n        },\r\n        quickBTN: {\r\n            default: null, type: cc.Node\r\n        },\r\n        waiting: {\r\n            default: null, type: cc.Node\r\n        },\r\n        loading: {\r\n            default: \"\", type: cc.String\r\n        },\r\n    },\r\n    \r\n    onV1: function(){\r\n        version = 1;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV2: function(){\r\n        version = 2;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV3: function(){\r\n        version = 3;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onV4: function(){\r\n        version = 4;\r\n        this.onClearClicked();\r\n    },\r\n    \r\n    onD0: function(){\r\n        denoiseV = 0;\r\n    },\r\n    \r\n    onD1: function(){\r\n        denoiseV = 1;\r\n    },\r\n    \r\n    onD2: function(){\r\n        denoiseV = 2;\r\n    },\r\n\r\n    onLoad: function () {\r\n        \r\n        cc.director.setClearColor(cc.color(0, 0, 0, 0))\r\n        \r\n        spSketchImg = this.sketchImg.getComponent('cc.Sprite');\r\n        spRefereneImg = this.referenceImg.getComponent('cc.Sprite');\r\n        spResultImg = this.resultImg.getComponent('cc.Sprite');\r\n        spColorImg = this.colorImg.getComponent('cc.Sprite');\r\n        spHintNode = this.hint;\r\n        view_node = this.view;\r\n        spBTN = this.btn.getComponent('cc.Button');\r\n        spLAB = this.btn.getComponent('cc.RichText');\r\n\r\n        white_result = spResultImg.spriteFrame.getTexture();\r\n        \r\n        fileInputForSketch = document.createElement(\"input\");\r\n        fileInputForSketch.id = \"fileInputForSketch\";\r\n        fileInputForSketch.type = \"file\";\r\n        fileInputForSketch.accept = \"image/*\";\r\n        fileInputForSketch.style.height = \"0px\";\r\n        fileInputForSketch.style.display = \"block\";\r\n        fileInputForSketch.style.overflow = \"hidden\";\r\n        document.body.insertBefore(fileInputForSketch,document.body.firstChild);\r\n        fileInputForSketch.addEventListener('change', onSketchFileSelected, false);\r\n        \r\n        fileInputForReferene = document.createElement(\"input\");\r\n        fileInputForReferene.id = \"fileInputForReferene\";\r\n        fileInputForReferene.type = \"file\";\r\n        fileInputForReferene.accept = \"image/*\";\r\n        fileInputForReferene.style.height = \"0px\";\r\n        fileInputForReferene.style.display = \"block\";\r\n        fileInputForReferene.style.overflow = \"hidden\";\r\n        document.body.insertBefore(fileInputForReferene,document.body.firstChild);\r\n        fileInputForReferene.addEventListener('change', onRefereneFileSelected, false);\r\n        \r\n        this.node.on(\"mousemove\", function (event) { \r\n            mousePosition = event.getLocation();\r\n        });\r\n        \r\n        this.node.on(\"mousedown\", function (event) { \r\n            mouseIsDown = true;\r\n        });\r\n        \r\n        this.node.on(\"mouseup\", function (event) { \r\n            getMouseDown = true;\r\n            mouseIsDown = false;\r\n        });\r\n        \r\n        HTML_Canvas_hint = document.createElement(\"canvas\");\r\n        HTML_Canvas_hint.id = \"HTML_Canvas_hint\";\r\n        \r\n        HTML_Canvas_reference = document.createElement(\"canvas\");\r\n        HTML_Canvas_reference.id = \"HTML_Canvas_reference\";\r\n        \r\n        HTML_Canvas_sketch = document.createElement(\"canvas\");\r\n        HTML_Canvas_sketch.id = \"HTML_Canvas_sketch\";\r\n\r\n        spQuickBTN = this.quickBTN;\r\n        spWaiting = this.waiting;\r\n\r\n        this.quickBTN.opacity = 0;\r\n        this.waiting.opacity = 0;\r\n        \r\n        loaded = true;\r\n        \r\n    },\r\n    \r\n    onSketchClicked: function(){\r\n        fileInputForSketch.click();\r\n    },\r\n    onRefenceClicked: function(){\r\n        fileInputForReferene.click();\r\n    },\r\n    onPenClicked: function(){\r\n        isPen = true;\r\n    },\r\n    onEraserClicked: function(){\r\n        isPen = false;\r\n    },\r\n    onClearClicked: function(){\r\n        var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n\t    cxt.clearRect(0,0,HTML_Canvas_hint.width,HTML_Canvas_hint.height);\r\n        var hintNodeTex = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n\t\thintNodeTex.initWithElement(HTML_Canvas_hint);\r\n\t\thintNodeTex.handleLoadedTexture();\r\n    },\r\n    onColorizeClicked: function(){\r\n        if(!hasRef){\r\n            return;\r\n        }\r\n        if(!hasSketch){\r\n            return;\r\n        }\r\n\r\n        this.waiting.opacity = 255;\r\n        this.quickBTN.opacity = 0;\r\n\r\n        var hintDataURL = HTML_Canvas_hint.toDataURL(\"image/png\");\r\n        var referenceDataURL = HTML_Canvas_reference.toDataURL(\"image/png\");\r\n        var sketchDataURL = HTML_Canvas_sketch.toDataURL(\"image/png\");\r\n        \r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"POST\", \"/paint\", true);\r\n        xhr.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded;\");\r\n        xhr.onreadystatechange = function() {\r\n            loadLocalResult(xhr.responseText);\r\n        };\r\n        if(sketchID!=\"new\"){\r\n            sketchDataURL = \"null\";\r\n        }\r\n        if(referenceID!=\"new\"){\r\n            referenceDataURL = \"null\";\r\n        }\r\n        xhr.send\r\n            (\r\n            \"sketch=\"+encodeURIComponent(sketchDataURL)+\r\n            \"&reference=\"+encodeURIComponent(referenceDataURL)+\r\n            \"&hint=\"+encodeURIComponent(hintDataURL)+\r\n            \"&version=\"+version.toString()+\r\n            \"&denoise=\"+denoiseV.toString()+\r\n            \"&sketchID=\"+sketchID+\r\n            \"&referenceID=\"+referenceID\r\n            );\r\n        spBTN.enabled = false;\r\n        resultTexture = null;\r\n        temp_btn_str = spLAB.string;\r\n        spLAB.string = this.loading;\r\n    },\r\n    onDownloadClicked: function(){\r\n        if(resultURL==\"\"){\r\n            return;\r\n        }\r\n        window.open(resultURL);\r\n    },\r\n    handlePainter: function(){\r\n        painting = false;\r\n        var relativeX = 0;\r\n        var relativeY = 0;\r\n        var refPosition = spSketchImg.node.convertToWorldSpace(spSketchImg.node.position);\r\n        if (refPosition != null && mousePosition != null) {\r\n            relativeX = mousePosition.x - refPosition.x;\r\n            relativeY = mousePosition.y - refPosition.y;\r\n            var mouseInSketch = (relativeX > 0 && relativeY > 0 && relativeX < spSketchImg.node.width && relativeY < spSketchImg.node.height);\r\n            if(mouseInSketch){\r\n                painting = true;\r\n            }\r\n        }\r\n        if(painting){\r\n            if(mouseIsDown){\r\n                var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n                \r\n                if(isPen){\r\n                    var pen = 6 - version;\r\n                    cxt.beginPath();\r\n                    cxt.arc(parseInt(parseFloat(relativeX) / parseFloat(spHintNode.width) * parseFloat(HTML_Canvas_hint.width)), parseInt(parseFloat(spHintNode.height - relativeY) / parseFloat(spHintNode.height) * parseFloat(HTML_Canvas_hint.height)), pen, 0, Math.PI * 2, true);\r\n                    cxt.closePath();\r\n                    var color = spColorImg.node.color\r\n                    cxt.fillStyle = 'rgba('+color.r.toString()+','+color.g.toString()+','+color.b.toString()+',0.618)';\r\n                    cxt.fill();\r\n                }else{\r\n                    var cxt=HTML_Canvas_hint.getContext(\"2d\");\r\n                    cxt.clearRect(parseInt(parseFloat(relativeX) / parseFloat(spHintNode.width) * parseFloat(HTML_Canvas_hint.width)) - 10, parseInt(parseFloat(spHintNode.height - relativeY) / parseFloat(spHintNode.height) * parseFloat(HTML_Canvas_hint.height)) - 10,20,20);\r\n                }\r\n                \r\n                var hintNodeTex = spHintNode.getComponent('cc.Sprite').spriteFrame.getTexture();\r\n                hintNodeTex.initWithElement(HTML_Canvas_hint);\r\n                hintNodeTex.handleLoadedTexture(true);\r\n            }\r\n        }\r\n    },\r\n    handleColorPicker: function(){\r\n        var refPosition = spRefereneImg.node.convertToWorldSpace(spRefereneImg.node.position);\r\n            if(refPosition != null && mousePosition != null){\r\n                var beginX = refPosition.x;\r\n                var beginY = refPosition.y;\r\n                var relativeX = mousePosition.x - beginX;\r\n                var relativeY = mousePosition.y - beginY;\r\n                mouseInReference = (relativeX > 0 && relativeY > 0 && relativeX < spRefereneImg.node.width && relativeY < spRefereneImg.node.height);\r\n                if(mouseInReference){\r\n                    if(!preMouseInRef){\r\n                        selectingColor = true;\r\n                    }\r\n                    if(getMouseDown){\r\n                        if(selectingColor){\r\n                        this.flag.x = relativeX - spRefereneImg.node.width / 2;\r\n                        this.flag.y = relativeY - spRefereneImg.node.height / 2;\r\n                        finalX = relativeX;\r\n                        finalY = relativeY;\r\n                        isPen = true;\r\n                        }\r\n                    }\r\n                }else{\r\n                    if(selectingColor){\r\n                        selectingColor = false;\r\n                        var texture = spRefereneImg.spriteFrame.getTexture();\r\n                        spColorImg.node.color = spRefereneImg.spriteFrame.getTexture().getPixels(finalX,finalY,spRefereneImg.node.width,spRefereneImg.node.height);\r\n                    }\r\n                }\r\n                if(selectingColor){\r\n                    var texture = spRefereneImg.spriteFrame.getTexture();\r\n                    spColorImg.node.color = spRefereneImg.spriteFrame.getTexture().getPixels(relativeX,relativeY,spRefereneImg.node.width,spRefereneImg.node.height);\r\n                }\r\n            }\r\n    },\r\n    update: function (dt) {\r\n        if(loaded){\r\n            this.handleColorPicker();\r\n            this.handlePainter();\r\n            if(selectingColor)\r\n            {\r\n                document.body.style.cursor='crosshair';\r\n            }\r\n            else if(painting)\r\n            {\r\n                document.body.style.cursor='crosshair';\r\n            }\r\n            else\r\n            {\r\n                document.body.style.cursor='default';\r\n            }\r\n        }\r\n        preMouseInRef = mouseInReference;\r\n        getMouseDown = false;\r\n\r\n        var w = parseFloat(sketch_w);\r\n        var h = parseFloat(sketch_h);\r\n        var max_w = parseFloat(view_node.width - 64);\r\n        var max_h = parseFloat(view_node.height);\r\n        var s0 = max_w / w;\r\n        var s1 = max_h / h;\r\n        var s = Math.min(s0, s1);\r\n        w = w * s;\r\n        h = h * s;\r\n        spSketchImg.node.width = parseInt(w);\r\n        spSketchImg.node.height = parseInt(h);\r\n        spHintNode.width = parseInt(w);\r\n        spHintNode.height = parseInt(h);\r\n        spResultImg.node.width = parseInt(w);\r\n        spResultImg.node.height = parseInt(h);\r\n\r\n        if (spBTN.enabled == false) {\r\n            if (resultTexture != null) {\r\n                if (resultTexture.isLoaded()) {  \r\n                    spResultImg.spriteFrame.setTexture(resultTexture);\r\n                    spBTN.enabled = true;\r\n                    spLAB.string = temp_btn_str;\r\n                    sketchID = tempID[0];\r\n                    referenceID = tempID[1];\r\n                    this.waiting.opacity = 0;\r\n                    this.quickBTN.opacity = 255;\r\n                }\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}